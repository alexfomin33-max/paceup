// lib/features/lenta/screens/activity/share_activity_screen.dart
import 'dart:developer';
import 'dart:typed_data';
import 'dart:ui' as ui;

import 'package:cached_network_image/cached_network_image.dart';
import 'package:flutter/cupertino.dart';
import 'package:flutter/material.dart';
import 'package:flutter/rendering.dart';
import 'package:latlong2/latlong.dart';
import 'package:share_plus/share_plus.dart';

import '../../../../core/theme/app_theme.dart';
import '../../../../core/utils/activity_format.dart';
import '../../../../core/utils/static_map_url_builder.dart';
import '../../../../core/widgets/app_bar.dart';
import '../../../../domain/models/activity_lenta.dart';

/// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/// ğŸ”¹ Ğ­ĞšĞ ĞĞ ĞŸĞĞ”Ğ“ĞĞ¢ĞĞ’ĞšĞ˜ Ğ Ğ•ĞŸĞĞ¡Ğ¢Ğ Ğ¢Ğ Ğ•ĞĞ˜Ğ ĞĞ’ĞšĞ˜
/// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/// Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚:
/// 1) AppBar Ñ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ¾Ğ¼ "ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°"
/// 2) Ğ’ĞµÑ€Ñ…Ğ½ÑÑ ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½ĞºÑƒ (ĞºĞ°Ğº Ğ² ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞµ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸)
/// 3) Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° Ñ„Ğ¾Ñ‚Ğ¾
/// 4) ĞœĞ¸Ğ½Ğ¸Ğ°Ñ‚ÑÑ€Ñ‹ Ñ„Ğ¾Ñ‚Ğ¾ Ñ Ğ¿Ğ¾Ğ´ÑĞ²ĞµÑ‚ĞºĞ¾Ğ¹ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¹
/// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class ShareActivityScreen extends StatefulWidget {
  final Activity activity;

  const ShareActivityScreen({
    super.key,
    required this.activity,
  });

  @override
  State<ShareActivityScreen> createState() => _ShareActivityScreenState();
}

class _ShareActivityScreenState extends State<ShareActivityScreen> {
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ”¹ Ğ”ĞĞĞĞ«Ğ• ĞœĞ•Ğ”Ğ˜Ğ Ğ˜ Ğ’Ğ«Ğ‘ĞĞ 
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  late final List<_ShareMediaItem> _mediaItems;
  late int _selectedIndex;
  int _displayModeIndex = 0;
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ”¹ Ğ˜ĞĞ¢Ğ•ĞĞ¡Ğ˜Ğ’ĞĞĞ¡Ğ¢Ğ¬ Ğ“Ğ ĞĞ”Ğ˜Ğ•ĞĞ¢ĞĞĞ“Ğ Ğ—ĞĞ¢Ğ•ĞœĞĞ•ĞĞ˜Ğ¯ (0.0 - 1.0)
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  late final ValueNotifier<double> _darknessOpacityNotifier;
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ”¹ Ğ¦Ğ’Ğ•Ğ¢ Ğ¢Ğ•ĞšĞ¡Ğ¢Ğ: Ğ‘Ğ•Ğ›Ğ«Ğ™ Ğ˜Ğ›Ğ˜ Ğ§Ğ•Ğ ĞĞ«Ğ™
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  bool _isTextWhite = true;
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ”¹ ĞšĞ›Ğ®Ğ§ Ğ”Ğ›Ğ¯ Ğ—ĞĞ¥Ğ’ĞĞ¢Ğ Ğ’Ğ•Ğ Ğ¥ĞĞ•Ğ“Ğ Ğ˜Ğ—ĞĞ‘Ğ ĞĞ–Ğ•ĞĞ˜Ğ¯
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  final GlobalKey _shareImageKey = GlobalKey();
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ”¹ ĞšĞ›Ğ®Ğ§ Ğ”Ğ›Ğ¯ Ğ¡ĞšĞ Ğ«Ğ¢ĞĞ“Ğ Ğ­ĞšĞ¡ĞŸĞĞ Ğ¢Ğ Ğ¡ ĞŸĞ ĞĞ—Ğ ĞĞ§ĞĞ«Ğœ Ğ¤ĞĞĞĞœ
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  final GlobalKey _shareExportImageKey = GlobalKey();
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ”¹ ĞŸĞ£Ğ¢Ğ¬ Ğš ĞŸĞ ĞĞ—Ğ ĞĞ§ĞĞĞœĞ£ ĞĞ¡Ğ¡Ğ•Ğ¢Ğ£
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  static const String _opacityAssetPath = 'assets/opacity.jpg';

  @override
  void initState() {
    super.initState();

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ”¹ Ğ¤ĞĞ ĞœĞ˜Ğ Ğ£Ğ•Ğœ Ğ•Ğ”Ğ˜ĞĞ«Ğ™ Ğ¡ĞŸĞ˜Ğ¡ĞĞš ĞœĞ•Ğ”Ğ˜Ğ
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    _mediaItems = _buildMediaItems(widget.activity);
    _selectedIndex = _mediaItems.isNotEmpty ? 0 : -1;

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ”¹ NOTIFIER Ğ”Ğ›Ğ¯ Ğ—ĞĞ¢Ğ•ĞœĞĞ•ĞĞ˜Ğ¯ (ĞœĞ˜ĞĞ˜ĞœĞ£Ğœ ĞŸĞ•Ğ Ğ•Ğ¡Ğ¢Ğ ĞĞ•ĞĞ˜Ğ™)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    _darknessOpacityNotifier = ValueNotifier<double>(0.0);
  }

  @override
  void dispose() {
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ”¹ ĞĞ§Ğ˜Ğ©ĞĞ•Ğœ NOTIFIER, Ğ§Ğ¢ĞĞ‘Ğ« Ğ˜Ğ—Ğ‘Ğ•Ğ–ĞĞ¢Ğ¬ Ğ£Ğ¢Ğ•Ğ§Ğ•Ğš ĞŸĞĞœĞ¯Ğ¢Ğ˜
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    _darknessOpacityNotifier.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ”¹ Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—Ğ£Ğ•Ğœ Ğ’Ğ¡Ğ• Ğ­Ğ›Ğ•ĞœĞ•ĞĞ¢Ğ« ĞœĞ•Ğ”Ğ˜Ğ (Ğ’ĞšĞ›Ğ®Ğ§ĞĞ¯ ĞĞ¡Ğ¡Ğ•Ğ¢ opacity.jpg)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    final visibleItems = _mediaItems;
    final selectedItem = _currentSelectedItem;

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ”¹ ĞĞ¡ĞĞĞ’ĞĞĞ™ ĞšĞĞĞ¢Ğ•Ğ™ĞĞ•Ğ  Ğ­ĞšĞ ĞĞĞ
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    return Scaffold(
      backgroundColor: AppColors.surface,
      appBar: const PaceAppBar(
        title: 'Ğ ĞµĞ¿Ğ¾ÑÑ‚',
        backgroundColor: AppColors.surface,
        showBottomDivider: false,
        elevation: 0,
        scrolledUnderElevation: 0,
      ),
      body: SafeArea(
        child: Column(
          children: [
            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            // ğŸ–¼ï¸ Ğ’Ğ•Ğ Ğ¥ĞĞ•Ğ• Ğ˜Ğ—ĞĞ‘Ğ ĞĞ–Ğ•ĞĞ˜Ğ• (Ğ—ĞĞ¤Ğ˜ĞšĞ¡Ğ˜Ğ ĞĞ’ĞĞĞ, ĞĞ• Ğ¡ĞšĞ ĞĞ›Ğ›Ğ˜Ğ¢Ğ¡Ğ¯)
            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            Padding(
              padding: const EdgeInsets.fromLTRB(24, 0, 24, 16),
              child: Stack(
                children: [
                  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                  // ğŸ§Š Ğ¡ĞšĞ Ğ«Ğ¢Ğ«Ğ™ Ğ­ĞšĞ¡ĞŸĞĞ Ğ¢: ĞŸĞ ĞĞ—Ğ ĞĞ§ĞĞ«Ğ™ Ğ¤ĞĞ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ”Ğ›Ğ¯ Ğ¨ĞĞ Ğ˜ĞĞ“Ğ
                  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                  if (_isOpacitySelected)
                    Positioned.fill(
                      child: IgnorePointer(
                        child: RepaintBoundary(
                          key: _shareExportImageKey,
                          // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                          // ğŸ”¹ Ğ¡Ğ›Ğ£Ğ¨ĞĞ•Ğœ Ğ—ĞĞ¢Ğ•ĞœĞĞ•ĞĞ˜Ğ• Ğ˜ ĞŸĞ•Ğ Ğ•Ğ¡Ğ¢Ğ ĞĞ˜Ğ’ĞĞ•Ğœ Ğ¢ĞĞ›Ğ¬ĞšĞ ĞšĞĞ Ğ¢Ğ˜ĞĞšĞ£
                          // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                          child: ValueListenableBuilder<double>(
                            valueListenable: _darknessOpacityNotifier,
                            builder: (context, darknessOpacity, child) {
                              return _ShareTopImage(
                                activity: widget.activity,
                                selectedItem: selectedItem,
                                heightFactor: 1.0, // Ğ§ÑƒÑ‚ÑŒ Ğ¼ĞµĞ½ÑŒÑˆĞµ Ğ¿Ğ¾ Ğ²Ñ‹ÑĞ¾Ñ‚Ğµ
                                displayModeIndex: _displayModeIndex,
                                isTransparentMode: _isOpacitySelected,
                                darknessOpacity: darknessOpacity,
                                isTextWhite: _isTextWhite,
                              );
                            },
                          ),
                        ),
                      ),
                    ),
                  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                  // ğŸ–¼ï¸ Ğ’Ğ•Ğ Ğ¥ĞĞ•Ğ• Ğ˜Ğ—ĞĞ‘Ğ ĞĞ–Ğ•ĞĞ˜Ğ• Ğ”Ğ›Ğ¯ ĞŸĞ Ğ•Ğ”ĞŸĞ ĞĞ¡ĞœĞĞ¢Ğ Ğ
                  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                  RepaintBoundary(
                    key: _shareImageKey,
                    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    // ğŸ”¹ Ğ¡Ğ›Ğ£Ğ¨ĞĞ•Ğœ Ğ—ĞĞ¢Ğ•ĞœĞĞ•ĞĞ˜Ğ• Ğ˜ ĞŸĞ•Ğ Ğ•Ğ¡Ğ¢Ğ ĞĞ˜Ğ’ĞĞ•Ğœ Ğ¢ĞĞ›Ğ¬ĞšĞ ĞšĞĞ Ğ¢Ğ˜ĞĞšĞ£
                    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    child: ValueListenableBuilder<double>(
                      valueListenable: _darknessOpacityNotifier,
                      builder: (context, darknessOpacity, child) {
                        return _ShareTopImage(
                          activity: widget.activity,
                          selectedItem: selectedItem,
                          heightFactor: 1.0, // Ğ§ÑƒÑ‚ÑŒ Ğ¼ĞµĞ½ÑŒÑˆĞµ Ğ¿Ğ¾ Ğ²Ñ‹ÑĞ¾Ñ‚Ğµ
                          displayModeIndex: _displayModeIndex,
                          darknessOpacity: darknessOpacity,
                          isTextWhite: _isTextWhite,
                        );
                      },
                    ),
                  ),
                ],
              ),
            ),
            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            // ğŸ“œ Ğ¡ĞšĞ ĞĞ›Ğ›Ğ˜Ğ Ğ£Ğ•ĞœĞ«Ğ™ ĞšĞĞĞ¢Ğ•ĞĞ¢
            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            Expanded(
              child: SingleChildScrollView(
                physics: const BouncingScrollPhysics(),
                padding: EdgeInsets.zero,
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.center,
                  children: [
                    const SizedBox(height: 12),

                    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    // ğŸ·ï¸ Ğ—ĞĞ“ĞĞ›ĞĞ’ĞĞš Ğ¡Ğ•ĞšĞ¦Ğ˜Ğ˜ Ğ’Ğ«Ğ‘ĞĞ Ğ
                    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    Padding(
                      padding: const EdgeInsets.fromLTRB(16, 0, 16, 0),
                      child: Align(
                        alignment: Alignment.centerLeft,
                        child: Text(
                          'Ğ¤Ğ¾Ñ‚Ğ¾ Ğ´Ğ»Ñ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸',
                          style: AppTextStyles.h15w4.copyWith(
                            color: AppColors.getTextPrimaryColor(context),
                          ),
                        ),
                      ),
                    ),
                    const SizedBox(height: 12),

                    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    // ğŸ“¸ ĞœĞ˜ĞĞ˜ĞĞ¢Ğ®Ğ Ğ« ĞœĞ•Ğ”Ğ˜Ğ: Ğ’Ğ«Ğ‘Ğ ĞĞĞĞĞ¯ 100%, ĞĞ¡Ğ¢ĞĞ›Ğ¬ĞĞ«Ğ• 50%
                    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    _SharePhotoSelector(
                      activity: widget.activity,
                      items: visibleItems,
                      selectedIndex: _selectedIndex,
                      onSelected: (index) {
                        setState(() {
                          _selectedIndex = index;
                        });
                      },
                    ),
                    const SizedBox(height: 28),

                    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    // ğŸ¨ Ğ¦Ğ’Ğ•Ğ¢ Ğ¢Ğ•ĞšĞ¡Ğ¢Ğ: Ğ—ĞĞ“ĞĞ›ĞĞ’ĞĞš Ğ˜ ĞšĞĞĞŸĞšĞ˜
                    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    Padding(
                      padding: const EdgeInsets.fromLTRB(16, 0, 16, 0),
                      child: Row(
                        children: [
                          Text(
                            'Ğ¦Ğ²ĞµÑ‚ Ñ‚ĞµĞºÑÑ‚Ğ°',
                            style: AppTextStyles.h15w4.copyWith(
                              color: AppColors.getTextPrimaryColor(context),
                            ),
                          ),
                          const Spacer(),
                          // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                          // ğŸ”¹ ĞšĞĞĞŸĞšĞ "Ğ‘Ğ•Ğ›Ğ«Ğ™" (Ğ¡Ğ’Ğ•Ğ¢Ğ›ĞĞ¯ Ğ¡ Ğ¢Ğ•ĞœĞĞ«Ğœ Ğ¢Ğ•ĞšĞ¡Ğ¢ĞĞœ)
                          // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                          GestureDetector(
                            onTap: () {
                              setState(() {
                                _isTextWhite = true;
                              });
                            },
                            child: Container(
                              padding: const EdgeInsets.all(1),
                              decoration: BoxDecoration(
                                borderRadius: BorderRadius.circular(AppRadius.xxl),
                                border: _isTextWhite
                                    ? Border.all(
                                        color: AppColors.brandPrimary,
                                        width: 2,
                                      )
                                    : Border.all(
                                        color: AppColors.getSurfaceColor(context),
                                        width: 2,
                                      ),
                              ),
                              child: Container(
                                padding: const EdgeInsets.symmetric(
                                  horizontal: 16,
                                  vertical: 5,
                                ),
                                decoration: BoxDecoration(
                                  color: AppColors.surface,
                                  borderRadius: BorderRadius.circular(AppRadius.xxl),
                                  border: Border.all(
                                    color: AppColors.getSurfaceColor(context),
                                    width: 1,
                                  ),
                                  boxShadow: [
                                    BoxShadow(
                                      color: Colors.black.withValues(alpha: 0.1),
                                      blurRadius: 10,
                                      offset: const Offset(0, 1),
                                    ),
                                  ],
                                ),
                                child: Text(
                                  'Ğ‘ĞµĞ»Ñ‹Ğ¹',
                                  style: AppTextStyles.h14w4.copyWith(
                                    color: AppColors.getTextPrimaryColor(context),
                                  ),
                                ),
                              ),
                            ),
                          ),
                          const SizedBox(width: 12),
                          // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                          // ğŸ”¹ ĞšĞĞĞŸĞšĞ "Ğ§Ğ•Ğ ĞĞ«Ğ™" (Ğ¢Ğ•ĞœĞĞĞ¯ Ğ¡Ğ Ğ¡Ğ’Ğ•Ğ¢Ğ›Ğ«Ğœ Ğ¢Ğ•ĞšĞ¡Ğ¢ĞĞœ)
                          // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                          GestureDetector(
                            onTap: () {
                              setState(() {
                                _isTextWhite = false;
                              });
                            },
                            child: Container(
                              padding: const EdgeInsets.all(1),
                              decoration: BoxDecoration(
                                borderRadius: BorderRadius.circular(AppRadius.xxl),
                                border: !_isTextWhite
                                    ? Border.all(
                                        color: AppColors.brandPrimary,
                                        width: 2,
                                      )
                                    : Border.all(
                                        color: AppColors.getSurfaceColor(context),
                                        width: 2,
                                      ),
                              ),
                              child: Container(
                                padding: const EdgeInsets.symmetric(
                                  horizontal: 16,
                                  vertical: 5,
                                ),
                                decoration: BoxDecoration(
                                  color: AppColors.button,
                                  borderRadius: BorderRadius.circular(AppRadius.xxl),
                                  border: Border.all(
                                    color: AppColors.getSurfaceColor(context),
                                    width: 1,
                                  ),
                                ),
                                child: Text(
                                  'Ğ§ĞµÑ€Ğ½Ñ‹Ğ¹',
                                  style: AppTextStyles.h14w4.copyWith(
                                    color: AppColors.getSurfaceColor(context),
                                  ),
                                ),
                              ),
                            ),
                          ),
                        ],
                      ),
                    ),
                    const SizedBox(height: 28),

                    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    // ğŸ§© Ğ’Ğ˜Ğ” ĞĞ¢ĞĞ‘Ğ ĞĞ–Ğ•ĞĞ˜Ğ¯: Ğ—ĞĞ“ĞĞ›ĞĞ’ĞĞš
                    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    Padding(
                      padding: const EdgeInsets.fromLTRB(16, 0, 16, 0),
                      child: Align(
                        alignment: Alignment.centerLeft,
                        child: Text(
                          'Ğ’Ğ¸Ğ´ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ',
                          style: AppTextStyles.h15w4.copyWith(
                            color: AppColors.getTextPrimaryColor(context),
                          ),
                        ),
                      ),
                    ),
                    const SizedBox(height: 12),

                    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    // ğŸ§© Ğ’Ğ˜Ğ” ĞĞ¢ĞĞ‘Ğ ĞĞ–Ğ•ĞĞ˜Ğ¯: 5 ĞŸĞ›Ğ•Ğ™Ğ¡Ğ¥ĞĞ›Ğ”Ğ•Ğ Ğ
                    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    SizedBox(
                      height: 100,
                      child: ListView.separated(
                        scrollDirection: Axis.horizontal,
                        physics: const BouncingScrollPhysics(),
                        padding: const EdgeInsets.symmetric(horizontal: 16),
                        itemCount: 5,
                        separatorBuilder: (context, index) =>
                            const SizedBox(width: 12),
                        itemBuilder: (context, index) {
                          final opacity = index == _displayModeIndex ? 1.0 : 0.5;
                          return GestureDetector(
                            onTap: () {
                              setState(() {
                                _displayModeIndex = index;
                              });
                            },
                            behavior: HitTestBehavior.opaque,
                            child: Opacity(
                              opacity: opacity,
                              child: Stack(
                                children: [
                                Container(
                                  width: 100,
                                  height: 100,
                                  decoration: BoxDecoration(
                                    gradient: const LinearGradient(
                                      begin: Alignment.topLeft,
                                      end: Alignment.bottomRight,
                                      colors: [
                                        Color.fromARGB(255, 135, 206, 250), // Ğ¡Ğ²ĞµÑ‚Ğ»Ñ‹Ğ¹ Ğ³Ğ¾Ğ»ÑƒĞ±Ğ¾Ğ¹
                                        Color.fromARGB(255, 70, 130, 180), // Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ³Ğ¾Ğ»ÑƒĞ±Ğ¾Ğ¹
                                        Color.fromARGB(255, 30, 90, 150), // Ğ¢ĞµĞ¼Ğ½Ñ‹Ğ¹ ÑĞ¸Ğ½Ğ¸Ğ¹
                                      ],
                                      stops: [0.0, 0.5, 1.0],
                                    ),
                                    borderRadius: BorderRadius.circular(AppRadius.lg),
                                  ),
                                ),
                                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                // ğŸ”¹ ĞĞ’ĞĞ›Ğ« Ğ”Ğ›Ğ¯ ĞŸĞ•Ğ Ğ’ĞĞ™ ĞœĞ˜ĞĞ˜ĞĞ¢Ğ®Ğ Ğ«: 3 Ğ¡ĞĞ˜Ğ—Ğ£ Ğ¡Ğ›Ğ•Ğ’Ğ, 1 Ğ¡Ğ’Ğ•Ğ Ğ¥Ğ£ Ğ¡ĞŸĞ ĞĞ’Ğ
                                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                if (index == 0) ...[
                                  Positioned(
                                    bottom: 12,
                                    left: 12,
                                    child: Row(
                                      mainAxisAlignment: MainAxisAlignment.start,
                                      children: List.generate(
                                        3,
                                        (_) => Container(
                                          margin: const EdgeInsets.only(right: 4),
                                          width: 20,
                                          height: 6,
                                          decoration: BoxDecoration(
                                            color: Colors.white,
                                            borderRadius: BorderRadius.circular(3),
                                          ),
                                        ),
                                      ),
                                    ),
                                  ),
                                  Positioned(
                                    top: 12,
                                    right: 12,
                                    child: Container(
                                      width: 20,
                                      height: 6,
                                      decoration: BoxDecoration(
                                        color: Colors.white,
                                        borderRadius: BorderRadius.circular(3),
                                      ),
                                    ),
                                  ),
                                ],
                                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                // ğŸ”¹ ĞĞ’ĞĞ›Ğ« Ğ”Ğ›Ğ¯ Ğ’Ğ¢ĞĞ ĞĞ™ ĞœĞ˜ĞĞ˜ĞĞ¢Ğ®Ğ Ğ«: 3 Ğ¡Ğ’Ğ•Ğ Ğ¥Ğ£ Ğ¡Ğ›Ğ•Ğ’Ğ, 1 Ğ¡ĞĞ˜Ğ—Ğ£ Ğ¡ĞŸĞ ĞĞ’Ğ
                                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                if (index == 1) ...[
                                  Positioned(
                                    top: 12,
                                    left: 12,
                                    child: Row(
                                      mainAxisAlignment: MainAxisAlignment.start,
                                      children: List.generate(
                                        3,
                                        (_) => Container(
                                          margin: const EdgeInsets.only(right: 4),
                                          width: 20,
                                          height: 6,
                                          decoration: BoxDecoration(
                                            color: Colors.white,
                                            borderRadius: BorderRadius.circular(3),
                                          ),
                                        ),
                                      ),
                                    ),
                                  ),
                                  Positioned(
                                    bottom: 12,
                                    right: 12,
                                    child: Container(
                                      width: 20,
                                      height: 6,
                                      decoration: BoxDecoration(
                                        color: Colors.white,
                                        borderRadius: BorderRadius.circular(3),
                                      ),
                                    ),
                                  ),
                                ],
                                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                // ğŸ”¹ ĞĞ’ĞĞ›Ğ« Ğ”Ğ›Ğ¯ Ğ¢Ğ Ğ•Ğ¢Ğ¬Ğ•Ğ™ ĞœĞ˜ĞĞ˜ĞĞ¢Ğ®Ğ Ğ«: 3 Ğ’Ğ•Ğ Ğ¢Ğ˜ĞšĞĞ›Ğ¬ĞĞ Ğ¡Ğ›Ğ•Ğ’Ğ Ğ¡ĞĞ˜Ğ—Ğ£, 1 Ğ¡Ğ’Ğ•Ğ Ğ¥Ğ£ Ğ¡ĞŸĞ ĞĞ’Ğ
                                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                if (index == 2) ...[
                                  Positioned(
                                    bottom: 12,
                                    left: 12,
                                    child: Column(
                                      mainAxisAlignment: MainAxisAlignment.start,
                                      children: List.generate(
                                        3,
                                        (_) => Container(
                                          margin: const EdgeInsets.only(bottom: 4),
                                          width: 20,
                                          height: 6,
                                          decoration: BoxDecoration(
                                            color: Colors.white,
                                            borderRadius: BorderRadius.circular(3),
                                          ),
                                        ),
                                      ),
                                    ),
                                  ),
                                  Positioned(
                                    top: 12,
                                    right: 12,
                                    child: Container(
                                      width: 20,
                                      height: 6,
                                      decoration: BoxDecoration(
                                        color: Colors.white,
                                        borderRadius: BorderRadius.circular(3),
                                      ),
                                    ),
                                  ),
                                ],
                                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                // ğŸ”¹ ĞĞ’ĞĞ›Ğ« Ğ”Ğ›Ğ¯ Ğ§Ğ•Ğ¢Ğ’Ğ•Ğ Ğ¢ĞĞ™ ĞœĞ˜ĞĞ˜ĞĞ¢Ğ®Ğ Ğ«: 3 Ğ’Ğ•Ğ Ğ¢Ğ˜ĞšĞĞ›Ğ¬ĞĞ Ğ¡ĞŸĞ ĞĞ’Ğ Ğ¡ĞĞ˜Ğ—Ğ£, 1 Ğ¡Ğ›Ğ•Ğ’Ğ Ğ¡Ğ’Ğ•Ğ Ğ¥Ğ£
                                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                if (index == 3) ...[
                                  Positioned(
                                    bottom: 12,
                                    right: 12,
                                    child: Column(
                                      mainAxisAlignment: MainAxisAlignment.start,
                                      children: List.generate(
                                        3,
                                        (_) => Container(
                                          margin: const EdgeInsets.only(bottom: 4),
                                          width: 20,
                                          height: 6,
                                          decoration: BoxDecoration(
                                            color: Colors.white,
                                            borderRadius: BorderRadius.circular(3),
                                          ),
                                        ),
                                      ),
                                    ),
                                  ),
                                  Positioned(
                                    top: 12,
                                    left: 12,
                                    child: Container(
                                      width: 20,
                                      height: 6,
                                      decoration: BoxDecoration(
                                        color: Colors.white,
                                        borderRadius: BorderRadius.circular(3),
                                      ),
                                    ),
                                  ),
                                ],
                                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                // ğŸ”¹ ĞĞ’ĞĞ›Ğ« Ğ”Ğ›Ğ¯ ĞŸĞ¯Ğ¢ĞĞ™ ĞœĞ˜ĞĞ˜ĞĞ¢Ğ®Ğ Ğ«: 4 ĞĞ’ĞĞ›Ğ ĞŸĞ Ğ¦Ğ•ĞĞ¢Ğ Ğ£ Ğ’Ğ•Ğ Ğ¢Ğ˜ĞšĞĞ›Ğ¬ĞĞ
                                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                if (index == 4)
                                  Positioned.fill(
                                    child: Center(
                                      child: Column(
                                        mainAxisAlignment: MainAxisAlignment.center,
                                        children: List.generate(
                                          4,
                                          (_) => Container(
                                            margin: const EdgeInsets.only(bottom: 4),
                                            width: 20,
                                            height: 6,
                                            decoration: BoxDecoration(
                                              color: Colors.white,
                                              borderRadius: BorderRadius.circular(3),
                                            ),
                                          ),
                                        ),
                                      ),
                                    ),
                                  ),
                              ],
                              ),
                            ),
                          );
                        },
                      ),
                    ),
                    const SizedBox(height: 20),

                    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    // ğŸŒ‘ Ğ—ĞĞ¢Ğ•ĞœĞĞ•ĞĞ˜Ğ• Ğ¤ĞĞĞ: Ğ—ĞĞ“ĞĞ›ĞĞ’ĞĞš Ğ˜ Ğ¡Ğ›ĞĞ™Ğ”Ğ•Ğ  (Ğ¡ĞšĞ Ğ«Ğ’ĞĞ•Ğœ Ğ”Ğ›Ğ¯ opacity.jpg)
                    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    if (!_isOpacitySelected) ...[
                      Padding(
                        padding: const EdgeInsets.fromLTRB(16, 0, 16, 0),
                        child: Row(
                          children: [
                            Text(
                              'Ğ—Ğ°Ñ‚ĞµĞ¼Ğ½ĞµĞ½Ğ¸Ğµ Ñ„Ğ¾Ğ½Ğ°',
                              style: AppTextStyles.h15w4.copyWith(
                                color: AppColors.getTextPrimaryColor(context),
                              ),
                            ),
                            const SizedBox(width: 16),
                            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                            // ğŸ”¹ Ğ¡ĞœĞ•Ğ©ĞĞ•Ğœ Ğ¡Ğ›ĞĞ™Ğ”Ğ•Ğ  Ğš ĞŸĞ ĞĞ’ĞĞœĞ£ ĞšĞ ĞĞ® Ğ¡Ğ¢Ğ ĞĞšĞ˜
                            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                            const Spacer(),
                            Expanded(
                              flex: 8,
                              child: SliderTheme(
                                data: SliderTheme.of(context).copyWith(
                                  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                  // ğŸ”¹ Ğ£Ğ’Ğ•Ğ›Ğ˜Ğ§Ğ•ĞĞĞĞ¯ Ğ’Ğ«Ğ¡ĞĞ¢Ğ Ğ”ĞĞ ĞĞ–ĞšĞ˜
                                  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                  trackHeight: 8.0,
                                  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                  // ğŸ”¹ ĞšĞĞ¡Ğ¢ĞĞœĞĞĞ¯ Ğ”ĞĞ ĞĞ–ĞšĞ Ğ¡ Ğ“Ğ ĞĞ”Ğ˜Ğ•ĞĞ¢ĞĞœ ĞĞ¢ Ğ‘Ğ•Ğ›ĞĞ“Ğ Ğ”Ğ Ğ§Ğ•Ğ ĞĞĞ“Ğ
                                  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                  trackShape: const _GradientSliderTrackShape(),
                                  // Ğ¦Ğ²ĞµÑ‚Ğ° Ğ½Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ÑÑ, Ñ‚Ğ°Ğº ĞºĞ°Ğº Ğ³Ñ€Ğ°Ğ´Ğ¸ĞµĞ½Ñ‚ Ñ€Ğ¸ÑÑƒĞµÑ‚ÑÑ ĞºĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ğ¾Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ¾Ğ¹
                                  activeTrackColor: Colors.grey,
                                  inactiveTrackColor: Colors.grey,
                                  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                  // ğŸ”¹ ĞšĞĞ¡Ğ¢ĞĞœĞĞ«Ğ™ THUMB
                                  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                  thumbShape: const RoundSliderThumbShape(
                                    enabledThumbRadius: 12.0,
                                  ),
                                  thumbColor: AppColors.button,
                                  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                  // ğŸ”¹ ĞĞ‘Ğ›ĞĞ¡Ğ¢Ğ¬ ĞĞĞ–ĞĞ¢Ğ˜Ğ¯
                                  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                  overlayShape: const RoundSliderOverlayShape(
                                    overlayRadius: 24.0,
                                  ),
                                  overlayColor: AppColors.button
                                      .withValues(alpha: 0.12),
                                  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                  // ğŸ”¹ ĞĞ¢ĞšĞ›Ğ®Ğ§ĞĞ•Ğœ VALUE INDICATOR
                                  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                  showValueIndicator: ShowValueIndicator.never,
                                ),
                              child: ValueListenableBuilder<double>(
                                valueListenable: _darknessOpacityNotifier,
                                builder: (context, darknessOpacity, child) {
                                  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                  // ğŸ”¹ ĞŸĞ•Ğ Ğ•Ğ¡Ğ¢Ğ ĞĞ˜Ğ’ĞĞ•Ğœ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ¡Ğ›ĞĞ™Ğ”Ğ•Ğ  ĞŸĞ Ğ˜ Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ˜
                                  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                  return Slider(
                                    value: darknessOpacity,
                                    min: 0.0,
                                    max: 1.0,
                                    divisions: 100,
                                    onChanged: (value) {
                                      _darknessOpacityNotifier.value = value;
                                    },
                                  );
                                },
                              ),
                              ),
                            ),
                          ],
                        ),
                      ),
                      const SizedBox(height: 28),
                    ],

                    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    // ğŸ”¹ ĞĞ¢Ğ¡Ğ¢Ğ£ĞŸ ĞŸĞ•Ğ Ğ•Ğ” ĞšĞĞĞŸĞšĞĞ™, Ğ•Ğ¡Ğ›Ğ˜ Ğ ĞĞ—Ğ”Ğ•Ğ› "Ğ—ĞĞ¢Ğ•ĞœĞĞ•ĞĞ˜Ğ• Ğ¤ĞĞĞ" Ğ¡ĞšĞ Ğ«Ğ¢
                    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    if (_isOpacitySelected) const SizedBox(height: 14),

                    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    // ğŸ”¹ ĞšĞĞĞŸĞšĞ "ĞŸĞĞ”Ğ•Ğ›Ğ˜Ğ¢Ğ¬Ğ¡Ğ¯"
                    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    Padding(
                      padding: const EdgeInsets.fromLTRB(16, 0, 16, 24),
                      child: _buildShareButton(context),
                    ),
                  ],
                ),
              ),
            ),
          ],
        ),
      ),
    );
  }

  /// ĞšĞ½Ğ¾Ğ¿ĞºĞ° "ĞŸĞ¾Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒÑÑ" Ğ² ÑÑ‚Ğ¸Ğ»Ğµ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ"
  Widget _buildShareButton(BuildContext context) {
    final textColor = AppColors.getSurfaceColor(context);

    return ElevatedButton(
      onPressed: _onSharePressed,
      style: ElevatedButton.styleFrom(
        backgroundColor: AppColors.button,
        foregroundColor: textColor,
        elevation: 0,
        padding: const EdgeInsets.symmetric(horizontal: 30),
        shape: const StadiumBorder(),
        minimumSize: const Size(double.infinity, 50),
        tapTargetSize: MaterialTapTargetSize.shrinkWrap,
        alignment: Alignment.center,
      ),
      child: Text(
        'ĞŸĞ¾Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒÑÑ',
        style: AppTextStyles.h15w5.copyWith(
          color: textColor,
          height: 1.0,
        ),
      ),
    );
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ”¹ ĞĞĞ–ĞĞ¢Ğ˜Ğ• "ĞŸĞĞ”Ğ•Ğ›Ğ˜Ğ¢Ğ¬Ğ¡Ğ¯": Ğ—ĞĞ¥Ğ’ĞĞ¢ + Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞĞ«Ğ™ Ğ‘ĞĞ¢Ğ¢ĞĞœ-Ğ¨Ğ˜Ğ¢
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Future<void> _onSharePressed() async {
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ”¹ Ğ—ĞĞ¥Ğ’ĞĞ¢Ğ«Ğ’ĞĞ•Ğœ Ğ˜Ğ—ĞĞ‘Ğ ĞĞ–Ğ•ĞĞ˜Ğ• Ğ¡ Ğ¢Ğ•ĞšĞ£Ğ©Ğ˜Ğœ Ğ ĞĞ¡ĞŸĞĞ›ĞĞ–Ğ•ĞĞ˜Ğ•Ğœ ĞĞ’Ğ•Ğ Ğ›Ğ•Ğ•Ğ’
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    final bytes = await _captureShareImageBytes();
    if (bytes == null || bytes.isEmpty) {
      log(
        'ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ ÑˆĞ°Ñ€Ğ¸Ğ½Ğ³Ğ°',
      );
      return;
    }
    if (!mounted) return;

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ”¹ ĞĞ¢ĞšĞ Ğ«Ğ’ĞĞ•Ğœ ĞĞĞ¢Ğ˜Ğ’ĞĞ«Ğ™ Ğ‘ĞĞ¢Ğ¢ĞĞœ-Ğ¨Ğ˜Ğ¢ ĞŸĞĞ”Ğ•Ğ›Ğ˜Ğ¢Ğ¬Ğ¡Ğ¯
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    final box = context.findRenderObject() as RenderBox?;
    try {
      await Share.shareXFiles(
        [
          XFile.fromData(
            bytes,
            name: 'paceup_share.png',
            mimeType: 'image/png',
          ),
        ],
        sharePositionOrigin: box == null
            ? Rect.zero
            : box.localToGlobal(Offset.zero) & box.size,
      );
    } catch (e, stackTrace) {
      log(
        'ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ñ ÑˆĞ°Ñ€Ğ¸Ğ½Ğ³Ğ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ',
        error: e,
        stackTrace: stackTrace,
      );
    }
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ”¹ Ğ—ĞĞ¥Ğ’ĞĞ¢ Ğ’Ğ•Ğ Ğ¥ĞĞ•Ğ“Ğ Ğ˜Ğ—ĞĞ‘Ğ ĞĞ–Ğ•ĞĞ˜Ğ¯ Ğ’ PNG-Ğ‘ĞĞ™Ğ¢Ğ«
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Future<Uint8List?> _captureShareImageBytes() async {
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ”¹ Ğ’Ğ«Ğ‘Ğ˜Ğ ĞĞ•Ğœ ĞšĞ›Ğ®Ğ§: ĞŸĞ ĞĞ—Ğ ĞĞ§ĞĞ«Ğ™ Ğ­ĞšĞ¡ĞŸĞĞ Ğ¢ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ”Ğ›Ğ¯ opacity.jpg
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    final key = _isOpacitySelected ? _shareExportImageKey : _shareImageKey;
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ”¹ ĞŸĞĞ›Ğ£Ğ§ĞĞ•Ğœ RepaintBoundary Ğ”Ğ›Ğ¯ Ğ¡ĞĞ˜ĞœĞšĞ
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    final renderObject = key.currentContext?.findRenderObject();
    if (renderObject is! RenderRepaintBoundary) {
      log(
        'RenderRepaintBoundary Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ´Ğ»Ñ Ğ·Ğ°Ñ…Ğ²Ğ°Ñ‚Ğ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ',
      );
      return null;
    }
    final repaintBoundary = renderObject;

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ”¹ Ğ Ğ•ĞĞ”Ğ•Ğ  Ğ’ PNG Ğ¡ Ğ£Ğ§Ğ•Ğ¢ĞĞœ PIXEL RATIO
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    final pixelRatio = MediaQuery.of(context).devicePixelRatio;
    for (var attempt = 0; attempt < 3; attempt++) {
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // ğŸ”¹ Ğ‘Ğ•Ğ—ĞĞŸĞĞ¡ĞĞĞ¯ ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ debugNeedsPaint (ĞœĞĞ–Ğ•Ğ¢ Ğ‘Ğ«Ğ¢Ğ¬ ĞĞ•Ğ”ĞĞ¡Ğ¢Ğ£ĞŸĞ•Ğ)
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      var needsPaint = false;
      try {
        needsPaint = repaintBoundary.debugNeedsPaint;
      } catch (e) {
        log(
          'debugNeedsPaint Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½, Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ',
          error: e,
        );
      }
      if (needsPaint) {
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // ğŸ”¹ Ğ–Ğ”Ğ•Ğœ ĞšĞĞ”Ğ , Ğ§Ğ¢ĞĞ‘Ğ« RENDEROBJECT Ğ£Ğ¡ĞŸĞ•Ğ› ĞŸĞ ĞĞ Ğ˜Ğ¡ĞĞ’ĞĞ¢Ğ¬Ğ¡Ğ¯
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        await WidgetsBinding.instance.endOfFrame;
      }
      try {
        final image = await repaintBoundary.toImage(pixelRatio: pixelRatio);
        final byteData = await image.toByteData(
          format: ui.ImageByteFormat.png,
        );
        image.dispose();
        return byteData?.buffer.asUint8List();
      } catch (e, stackTrace) {
        log(
          'ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ñ…Ğ²Ğ°Ñ‚Ğ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ (Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ° ${attempt + 1})',
          error: e,
          stackTrace: stackTrace,
        );
        await WidgetsBinding.instance.endOfFrame;
      }
    }
    return null;
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ”¹ Ğ¢Ğ•ĞšĞ£Ğ©Ğ˜Ğ™ Ğ’Ğ«Ğ‘Ğ ĞĞĞĞ«Ğ™ Ğ­Ğ›Ğ•ĞœĞ•ĞĞ¢
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  _ShareMediaItem? get _currentSelectedItem =>
      (_selectedIndex >= 0 && _selectedIndex < _mediaItems.length)
          ? _mediaItems[_selectedIndex]
          : null;

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ”¹ ĞŸĞ ĞĞ—Ğ ĞĞ§ĞĞ«Ğ™ Ğ Ğ•Ğ–Ğ˜Ğœ Ğ”Ğ›Ğ¯ opacity.jpg
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  bool get _isOpacitySelected =>
      _currentSelectedItem?.isAsset == true &&
      _currentSelectedItem?.imageUrl == _opacityAssetPath;
}

/// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/// ğŸ”¹ Ğ’Ğ•Ğ Ğ¥ĞĞ•Ğ• Ğ˜Ğ—ĞĞ‘Ğ ĞĞ–Ğ•ĞĞ˜Ğ•: Ğ¤ĞĞ¢Ğ/ĞšĞĞ Ğ¢Ğ/Ğ”Ğ•Ğ¤ĞĞ›Ğ¢
/// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class _ShareTopImage extends StatelessWidget {
  final Activity activity;
  final _ShareMediaItem? selectedItem;
  final double heightFactor;
  final int displayModeIndex;
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ”¹ Ğ Ğ•Ğ–Ğ˜Ğœ ĞŸĞ ĞĞ—Ğ ĞĞ§ĞĞĞ“Ğ Ğ¤ĞĞĞ Ğ”Ğ›Ğ¯ opacity.jpg
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  final bool isTransparentMode;
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ”¹ Ğ˜ĞĞ¢Ğ•ĞĞ¡Ğ˜Ğ’ĞĞĞ¡Ğ¢Ğ¬ Ğ“Ğ ĞĞ”Ğ˜Ğ•ĞĞ¢ĞĞĞ“Ğ Ğ—ĞĞ¢Ğ•ĞœĞĞ•ĞĞ˜Ğ¯ (0.0 - 1.0)
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  final double darknessOpacity;
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ”¹ Ğ¦Ğ’Ğ•Ğ¢ Ğ¢Ğ•ĞšĞ¡Ğ¢Ğ: Ğ‘Ğ•Ğ›Ğ«Ğ™ Ğ˜Ğ›Ğ˜ Ğ§Ğ•Ğ ĞĞ«Ğ™
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  final bool isTextWhite;

  const _ShareTopImage({
    required this.activity,
    required this.selectedItem,
    this.heightFactor = 1.1,
    required this.displayModeIndex,
    this.isTransparentMode = false,
    this.darknessOpacity = 0.0,
    this.isTextWhite = true,
  });

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ”¹ ĞŸĞĞ›Ğ£Ğ§Ğ•ĞĞ˜Ğ• Ğ˜ĞšĞĞĞšĞ˜ Ğ’Ğ˜Ğ”Ğ Ğ¡ĞŸĞĞ Ğ¢Ğ
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  IconData _getSportIcon(String activityType) {
    final type = activityType.toLowerCase();
    if (type == 'run' || type == 'running' || type == 'indoor-running') {
      return Icons.directions_run;
    } else if (type == 'bike' ||
        type == 'cycling' ||
        type == 'bicycle' ||
        type == 'indoor-cycling') {
      return Icons.directions_bike;
    } else if (type == 'swim' || type == 'swimming') {
      return Icons.pool;
    } else if (type == 'ski' || type == 'skiing') {
      return Icons.downhill_skiing;
    } else if (type == 'walking' || type == 'hiking') {
      return Icons.directions_walk;
    }
    // Ğ”ĞµÑ„Ğ¾Ğ»Ñ‚Ğ½Ğ°Ñ Ğ¸ĞºĞ¾Ğ½ĞºĞ° Ğ´Ğ»Ñ Ğ±ĞµĞ³Ğ°
    return Icons.directions_run;
  }

  @override
  Widget build(BuildContext context) {
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ”¹ Ğ ĞĞ¡Ğ¡Ğ§Ğ•Ğ¢ Ğ’Ğ«Ğ¡ĞĞ¢Ğ« ĞŸĞ ĞŸĞ ĞĞŸĞĞ Ğ¦Ğ˜Ğ˜ 1:1.1 (ĞšĞĞš Ğ’ ĞšĞĞ Ğ¢ĞĞ§ĞšĞ•)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    return LayoutBuilder(
      builder: (context, constraints) {
        final width = constraints.maxWidth;
        final height = width * heightFactor;

        return SizedBox(
          width: width,
          height: height,
          child: ClipRRect(
            borderRadius: BorderRadius.circular(AppRadius.lg),
            child: Stack(
              fit: StackFit.expand,
              clipBehavior: Clip.hardEdge,
              children: [
                _buildTopImageContent(
                  context,
                  width,
                  height,
                  isTransparentMode: isTransparentMode,
                ),
                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                // ğŸŒ‘ Ğ ĞĞ”Ğ˜ĞĞ›Ğ¬ĞĞĞ• Ğ—ĞĞ¢Ğ•ĞœĞĞ•ĞĞ˜Ğ•: Ğ¾Ñ‚ Ñ†ĞµĞ½Ñ‚Ñ€Ğ° Ğº ĞºÑ€Ğ°ÑĞ¼
                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                if (!isTransparentMode && darknessOpacity > 0.0)
                  Positioned.fill(
                    child: IgnorePointer(
                      child: Container(
                        decoration: BoxDecoration(
                          gradient: RadialGradient(
                            center: Alignment.center,
                            radius: 1.0,
                            colors: [
                              Colors.transparent,
                              Colors.black.withValues(
                                alpha: darknessOpacity,
                              ),
                            ],
                            stops: [0.0, 1.0],
                          ),
                        ),
                      ),
                    ),
                  ),
                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                // ğŸ–¼ï¸ ĞĞ’Ğ•Ğ Ğ›Ğ•Ğ™ Ğ˜Ğ— ĞĞ¡Ğ¡Ğ•Ğ¢ĞĞ’: Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ğ¸Ğ´Ğ°
                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                // ğŸ§© ĞŸĞĞ—Ğ˜Ğ¦Ğ˜Ğ¯ Ğ›ĞĞ“ĞĞ¢Ğ˜ĞŸĞ: 4-Ğ«Ğ™ Ğ’Ğ˜Ğ” â€” Ğ¡Ğ›Ğ•Ğ’Ğ Ğ¡Ğ’Ğ•Ğ Ğ¥Ğ£, 5-Ğ«Ğ™ Ğ’Ğ˜Ğ” â€” ĞŸĞ Ğ¦Ğ•ĞĞ¢Ğ Ğ£
                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                Positioned(
                  top: displayModeIndex == 1
                      ? null
                      : displayModeIndex == 4
                          ? null
                          : (displayModeIndex == 0 ||
                                  displayModeIndex == 2 ||
                                  displayModeIndex == 3)
                              ? 16
                              : 12,
                  bottom: displayModeIndex == 1
                      ? 12
                      : displayModeIndex == 4
                          ? null
                          : null,
                  left: displayModeIndex == 3
                      ? 16
                      : displayModeIndex == 4
                          ? null
                          : null,
                  right: displayModeIndex == 3
                      ? null
                      : displayModeIndex == 4
                          ? null
                          : 20,
                  child: displayModeIndex == 4
                      ? Center(
                          child: Column(
                            mainAxisSize: MainAxisSize.min,
                            children: [
                              Image.asset(
                                isTextWhite
                                    ? 'assets/white_text.png'
                                    : 'assets/black_text.png',
                                width: 90,
                                fit: BoxFit.contain,
                              ),
                              const SizedBox(height: 16),
                              Icon(
                                _getSportIcon(activity.type),
                                size: 32,
                                color: isTextWhite
                                    ? Colors.white
                                    : Colors.black,
                              ),
                              const SizedBox(height: 12),
                              _buildOverlayMetricsColumnCentered(context),
                            ],
                          ),
                        )
                      : Image.asset(
                          isTextWhite
                              ? 'assets/white_logo.png'
                              : 'assets/black_logo.png',
                          width: 100,
                          fit: BoxFit.contain,
                        ),
                ),
                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                // ğŸ§© ĞœĞ•Ğ¢Ğ Ğ˜ĞšĞ˜: 4-Ğ«Ğ™ Ğ’Ğ˜Ğ” â€” Ğ’Ğ•Ğ Ğ¢Ğ˜ĞšĞĞ›Ğ¬ĞĞ Ğ¡ĞĞ˜Ğ—Ğ£ Ğ¡ĞŸĞ ĞĞ’Ğ, 5-Ğ«Ğ™ Ğ’Ğ˜Ğ” â€” Ğ’ COLUMN ĞŸĞĞ” Ğ˜ĞšĞĞĞšĞĞ™
                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                if (displayModeIndex == 2)
                  Positioned(
                    left: 16,
                    bottom: 12,
                    child: _buildOverlayMetricsColumn(context),
                  )
                else if (displayModeIndex == 3)
                  Positioned(
                    right: 16,
                    bottom: 12,
                    child: _buildOverlayMetricsColumn(
                      context,
                      isRightAligned: true,
                    ),
                  )
                else if (displayModeIndex != 4)
                  Positioned(
                    left: 16,
                    right: 16,
                    top: displayModeIndex == 1 ? 12 : null,
                    bottom: displayModeIndex == 1 ? null : 12,
                    child: _buildOverlayMetricsRow(context),
                  ),
              ],
            ),
          ),
        );
      },
    );
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ”¹ ĞšĞĞĞ¢Ğ•ĞĞ¢ Ğ˜Ğ—ĞĞ‘Ğ ĞĞ–Ğ•ĞĞ˜Ğ¯: Ğ¤ĞĞ¢Ğ â†’ ĞšĞĞ Ğ¢Ğ â†’ Ğ”Ğ•Ğ¤ĞĞ›Ğ¢
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Widget _buildTopImageContent(
    BuildContext context,
    double width,
    double height, {
    bool isTransparentMode = false,
  }) {
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ”¹ ĞŸĞ ĞĞ—Ğ ĞĞ§ĞĞ«Ğ™ Ğ¤ĞĞ: Ğ¢ĞĞ›Ğ¬ĞšĞ ĞĞ’Ğ•Ğ Ğ›Ğ•Ğ˜
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if (isTransparentMode) {
      return const ColoredBox(
        color: Colors.transparent,
      );
    }
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ”¹ Ğ•Ğ¡Ğ›Ğ˜ Ğ’Ğ«Ğ‘Ğ ĞĞ ĞšĞĞĞšĞ Ğ•Ğ¢ĞĞ«Ğ™ Ğ­Ğ›Ğ•ĞœĞ•ĞĞ¢ â€” ĞŸĞĞšĞĞ—Ğ«Ğ’ĞĞ•Ğœ Ğ•Ğ“Ğ
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if (selectedItem != null) {
      if (selectedItem!.isMap && activity.points.isNotEmpty) {
        return _buildMapImage(context, width, height);
      }
      if (!selectedItem!.isMap && selectedItem!.imageUrl != null) {
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // ğŸ”¹ Ğ•Ğ¡Ğ›Ğ˜ Ğ’Ğ«Ğ‘Ğ ĞĞ Ğ§Ğ•Ğ ĞĞ«Ğ™ Ğ¢Ğ•ĞšĞ¡Ğ¢ Ğ˜ opacity.jpg â€” Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—Ğ£Ğ•Ğœ opacity_white.png
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        final imageUrl = selectedItem!.imageUrl == 'assets/opacity.jpg' &&
                !isTextWhite
            ? 'assets/opacity_white.png'
            : selectedItem!.imageUrl!;
        return _buildPhotoImage(
          context,
          width,
          height,
          imageUrl,
          isAsset: selectedItem!.isAsset,
        );
      }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ”¹ 1. Ğ•Ğ¡Ğ›Ğ˜ Ğ•Ğ¡Ğ¢Ğ¬ Ğ¤ĞĞ¢Ğ â€” ĞŸĞĞšĞĞ—Ğ«Ğ’ĞĞ•Ğœ ĞŸĞ•Ğ Ğ’ĞĞ•
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if (activity.mediaImages.isNotEmpty) {
      return _buildPhotoImage(
        context,
        width,
        height,
        activity.mediaImages.first,
      );
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ”¹ 2. Ğ•Ğ¡Ğ›Ğ˜ Ğ¤ĞĞ¢Ğ ĞĞ•Ğ¢, ĞĞ Ğ•Ğ¡Ğ¢Ğ¬ ĞœĞĞ Ğ¨Ğ Ğ£Ğ¢ â€” ĞŸĞĞšĞĞ—Ğ«Ğ’ĞĞ•Ğœ ĞšĞĞ Ğ¢Ğ£
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if (activity.points.isNotEmpty) {
      return _buildMapImage(context, width, height);
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ”¹ 3. Ğ•Ğ¡Ğ›Ğ˜ ĞĞ•Ğ¢ Ğ¤ĞĞ¢Ğ Ğ˜ ĞœĞĞ Ğ¨Ğ Ğ£Ğ¢Ğ â€” Ğ”Ğ•Ğ¤ĞĞ›Ğ¢ĞĞĞ¯ ĞšĞĞ Ğ¢Ğ˜ĞĞšĞ
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    final defaultImagePath = getDefaultNoRouteImagePath(activity.type);

    return Image.asset(
      defaultImagePath,
      fit: BoxFit.cover,
      errorBuilder: (context, error, stackTrace) => Container(
        color: AppColors.twinphoto,
        child: const Center(
          child: Icon(
            CupertinoIcons.photo,
            size: 40,
            color: AppColors.scrim20,
          ),
        ),
      ),
    );
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ”¹ ĞŸĞĞ¡Ğ¢Ğ ĞĞ•ĞĞ˜Ğ• Ğ¤ĞĞ¢Ğ
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Widget _buildPhotoImage(
    BuildContext context,
    double width,
    double height,
    String imageUrl, {
    bool isAsset = false,
  }) {
    if (isAsset) {
      return Image.asset(
        imageUrl,
        fit: BoxFit.cover,
        width: width,
        height: height,
        errorBuilder: (context, error, stackTrace) => Container(
          color: AppColors.twinphoto,
          child: const Center(
            child: Icon(
              CupertinoIcons.photo,
              size: 40,
              color: AppColors.scrim20,
            ),
          ),
        ),
      );
    }

    final dpr = MediaQuery.of(context).devicePixelRatio;
    final w = (width * dpr).round();
    final h = (height * dpr).round();

    return CachedNetworkImage(
      imageUrl: imageUrl,
      fit: BoxFit.cover,
      memCacheWidth: w,
      memCacheHeight: h,
      maxWidthDiskCache: w,
      maxHeightDiskCache: h,
      placeholder: (context, url) => Container(
        color: AppColors.twinphoto,
        child: const Center(
          child: CupertinoActivityIndicator(),
        ),
      ),
      errorWidget: (context, url, error) => Container(
        color: AppColors.twinphoto,
        child: const Center(
          child: Icon(
            CupertinoIcons.photo,
            size: 40,
            color: AppColors.scrim20,
          ),
        ),
      ),
    );
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ”¹ ĞŸĞĞ¡Ğ¢Ğ ĞĞ•ĞĞ˜Ğ• ĞšĞĞ Ğ¢Ğ«
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Widget _buildMapImage(
    BuildContext context,
    double width,
    double height,
  ) {
    final points = activity.points.map((c) => LatLng(c.lat, c.lng)).toList();

    final dpr = MediaQuery.of(context).devicePixelRatio;
    final optimizedDpr = (dpr > 1.5 ? 1.5 : dpr).clamp(1.0, 1.5);
    final w = (width * optimizedDpr).round();
    final h = (height * optimizedDpr).round();

    final mapUrl = StaticMapUrlBuilder.fromPoints(
      points: points,
      widthPx: w.toDouble(),
      heightPx: h.toDouble(),
      strokeWidth: 3.0,
      padding: 12.0,
      maxWidth: 1280.0,
      maxHeight: 1280.0,
    );

    return CachedNetworkImage(
      imageUrl: mapUrl,
      fit: BoxFit.cover,
      memCacheWidth: w,
      memCacheHeight: h,
      maxWidthDiskCache: w,
      maxHeightDiskCache: h,
      placeholder: (context, url) => Container(
        color: AppColors.twinphoto,
        child: const Center(
          child: CupertinoActivityIndicator(),
        ),
      ),
      errorWidget: (context, url, error) => Container(
        color: AppColors.twinphoto,
        child: const Center(
          child: Icon(
            CupertinoIcons.map,
            size: 40,
            color: AppColors.scrim20,
          ),
        ),
      ),
    );
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ”¹ ĞœĞ•Ğ¢Ğ Ğ˜ĞšĞ˜ ĞŸĞĞ’Ğ•Ğ Ğ¥ Ğ¤ĞĞ¢Ğ: Ğ‘Ğ•Ğ— Ğ¢Ğ•ĞœĞĞĞ“Ğ Ğ“Ğ ĞĞ”Ğ˜Ğ•ĞĞ¢Ğ
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Widget _buildOverlayMetricsRow(BuildContext context) {
    final textColor = isTextWhite
        ? Colors.white
        : AppColors.getTextPrimaryColor(context);
    final stats = activity.stats;
    final activityTypeLower = activity.type.toLowerCase();
    final isSwim =
        activityTypeLower == 'swim' || activityTypeLower == 'swimming';
    final isBike =
        activityTypeLower == 'bike' ||
        activityTypeLower == 'bicycle' ||
        activityTypeLower == 'cycling' ||
        activityTypeLower == 'indoor-cycling';

    String formatSwimDistance(double meters) {
      final value = meters.toStringAsFixed(0);
      final buffer = StringBuffer();
      for (int i = 0; i < value.length; i++) {
        if (i > 0 && (value.length - i) % 3 == 0) {
          buffer.write(' ');
        }
        buffer.write(value[i]);
      }
      return buffer.toString();
    }

    final distanceText = stats?.distance != null
        ? isSwim
            ? '${formatSwimDistance(stats!.distance)} Ğ¼'
            : '${(stats!.distance / 1000.0).toStringAsFixed(2)} ĞºĞ¼'
        : 'â€”';

    final durationText = stats?.effectiveDuration != null
        ? formatDuration(stats!.effectiveDuration)
        : 'â€”';

    String paceText;
    double? speedKmh;

    if (isSwim) {
      if (stats?.avgPace != null && stats!.avgPace > 0) {
        paceText = formatPace(stats.avgPace / 10.0);
      } else if (stats?.distance != null &&
          stats?.effectiveDuration != null &&
          stats!.distance > 0 &&
          stats.effectiveDuration > 0) {
        final duration = stats.effectiveDuration.toDouble();
        final paceMinPer100m = (duration * 100) / (stats.distance * 60);
        paceText = formatPace(paceMinPer100m);
      } else {
        paceText = 'â€”';
      }
    } else {
      paceText = stats?.avgPace != null ? formatPace(stats!.avgPace) : 'â€”';
    }

    if (isBike) {
      if (activity.points.isEmpty &&
          stats?.distance != null &&
          stats?.effectiveDuration != null &&
          stats!.distance > 0 &&
          stats.effectiveDuration > 0) {
        final duration = stats.effectiveDuration.toDouble();
        speedKmh = (stats.distance / duration) * 3.6;
      } else if (stats?.avgSpeed != null && stats!.avgSpeed > 0) {
        speedKmh = stats.avgSpeed;
      } else if (stats?.distance != null &&
          stats?.effectiveDuration != null &&
          stats!.distance > 0 &&
          stats.effectiveDuration > 0) {
        final duration = stats.effectiveDuration.toDouble();
        speedKmh = (stats.distance / duration) * 3.6;
      }
    } else {
      if (stats?.distance != null &&
          stats?.effectiveDuration != null &&
          stats!.distance > 0 &&
          stats.effectiveDuration > 0) {
        final duration = stats.effectiveDuration.toDouble();
        speedKmh = (stats.distance / duration) * 3.6;
      }
    }

    final speedText = speedKmh != null
        ? '${speedKmh.toStringAsFixed(1)} ĞºĞ¼/Ñ‡'
        : 'â€”';

    return Row(
      mainAxisSize: MainAxisSize.max,
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        SizedBox(
          width: 130,
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              Text(
                'Ğ Ğ°ÑÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ',
                style: AppTextStyles.h11w4Sec.copyWith(
                  color: textColor,
                ),
              ),
              const SizedBox(height: 1),
              distanceText == 'â€”'
                  ? Text(
                      distanceText,
                      style: AppTextStyles.h17w6.copyWith(
                        color: textColor,
                      ),
                    )
                  : Text.rich(
                      TextSpan(
                        children: [
                          TextSpan(
                            text: distanceText
                                .replaceAll(' ĞºĞ¼', '')
                                .replaceAll(' Ğ¼', ''),
                            style: AppTextStyles.h17w6.copyWith(
                              color: textColor,
                            ),
                          ),
                          TextSpan(
                            text: distanceText.contains(' ĞºĞ¼') ? ' ĞºĞ¼' : ' Ğ¼',
                            style: AppTextStyles.h17w6.copyWith(
                              fontSize: 16,
                              color: textColor,
                            ),
                          ),
                        ],
                      ),
                    ),
            ],
          ),
        ),
        SizedBox(
          width: 110,
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              Text(
                'Ğ’Ñ€ĞµĞ¼Ñ, Ğ¼Ğ¸Ğ½',
                style: AppTextStyles.h11w4Sec.copyWith(
                  color: textColor,
                ),
              ),
              const SizedBox(height: 0),
              Text(
                durationText,
                style: AppTextStyles.h17w6.copyWith(
                  color: textColor,
                ),
              ),
            ],
          ),
        ),
        Expanded(
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              Text(
                isBike
                    ? 'Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ'
                    : isSwim
                        ? 'Ğ¢ĞµĞ¼Ğ¿, /100Ğ¼'
                        : 'Ğ¢ĞµĞ¼Ğ¿, /ĞºĞ¼',
                style: AppTextStyles.h11w4Sec.copyWith(
                  color: textColor,
                ),
              ),
              const SizedBox(height: 0),
              isBike
                  ? (speedText == 'â€”'
                      ? Text(
                          speedText,
                          style: AppTextStyles.h17w6.copyWith(
                            color: textColor,
                          ),
                        )
                      : Text.rich(
                          TextSpan(
                            children: [
                              TextSpan(
                                text: speedText.replaceAll(' ĞºĞ¼/Ñ‡', ''),
                                style: AppTextStyles.h17w6.copyWith(
                                  color: textColor,
                                ),
                              ),
                              TextSpan(
                                text: ' ĞºĞ¼/Ñ‡',
                                style: AppTextStyles.h17w6.copyWith(
                                  fontSize: 16,
                                  color: textColor,
                                ),
                              ),
                            ],
                          ),
                        ))
                  : Text(
                      paceText,
                      style: AppTextStyles.h17w6.copyWith(
                        color: textColor,
                      ),
                    ),
            ],
          ),
        ),
      ],
    );
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ”¹ ĞœĞ•Ğ¢Ğ Ğ˜ĞšĞ˜ Ğ’ ĞšĞĞ›ĞĞĞšĞ£: Ğ”Ğ›Ğ¯ Ğ¢Ğ Ğ•Ğ¢Ğ¬Ğ•Ğ“Ğ Ğ’Ğ˜Ğ”Ğ
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Widget _buildOverlayMetricsColumn(
    BuildContext context, {
    bool isRightAligned = false,
  }) {
    final textColor = isTextWhite
        ? Colors.white
        : AppColors.getTextPrimaryColor(context);
    final textAlign = isRightAligned ? TextAlign.right : TextAlign.left;
    final itemCrossAxisAlignment = isRightAligned
        ? CrossAxisAlignment.end
        : CrossAxisAlignment.start;
    final itemAlignment = isRightAligned
        ? Alignment.centerRight
        : Alignment.centerLeft;
    final stats = activity.stats;
    final activityTypeLower = activity.type.toLowerCase();
    final isSwim =
        activityTypeLower == 'swim' || activityTypeLower == 'swimming';
    final isBike =
        activityTypeLower == 'bike' ||
        activityTypeLower == 'bicycle' ||
        activityTypeLower == 'cycling' ||
        activityTypeLower == 'indoor-cycling';

    String formatSwimDistance(double meters) {
      final value = meters.toStringAsFixed(0);
      final buffer = StringBuffer();
      for (int i = 0; i < value.length; i++) {
        if (i > 0 && (value.length - i) % 3 == 0) {
          buffer.write(' ');
        }
        buffer.write(value[i]);
      }
      return buffer.toString();
    }

    final distanceText = stats?.distance != null
        ? isSwim
            ? '${formatSwimDistance(stats!.distance)} Ğ¼'
            : '${(stats!.distance / 1000.0).toStringAsFixed(2)} ĞºĞ¼'
        : 'â€”';

    final durationText = stats?.effectiveDuration != null
        ? formatDuration(stats!.effectiveDuration)
        : 'â€”';

    String paceText;
    double? speedKmh;

    if (isSwim) {
      if (stats?.avgPace != null && stats!.avgPace > 0) {
        paceText = formatPace(stats.avgPace / 10.0);
      } else if (stats?.distance != null &&
          stats?.effectiveDuration != null &&
          stats!.distance > 0 &&
          stats.effectiveDuration > 0) {
        final duration = stats.effectiveDuration.toDouble();
        final paceMinPer100m = (duration * 100) / (stats.distance * 60);
        paceText = formatPace(paceMinPer100m);
      } else {
        paceText = 'â€”';
      }
    } else {
      paceText = stats?.avgPace != null ? formatPace(stats!.avgPace) : 'â€”';
    }

    if (isBike) {
      if (activity.points.isEmpty &&
          stats?.distance != null &&
          stats?.effectiveDuration != null &&
          stats!.distance > 0 &&
          stats.effectiveDuration > 0) {
        final duration = stats.effectiveDuration.toDouble();
        speedKmh = (stats.distance / duration) * 3.6;
      } else if (stats?.avgSpeed != null && stats!.avgSpeed > 0) {
        speedKmh = stats.avgSpeed;
      } else if (stats?.distance != null &&
          stats?.effectiveDuration != null &&
          stats!.distance > 0 &&
          stats.effectiveDuration > 0) {
        final duration = stats.effectiveDuration.toDouble();
        speedKmh = (stats.distance / duration) * 3.6;
      }
    } else {
      if (stats?.distance != null &&
          stats?.effectiveDuration != null &&
          stats!.distance > 0 &&
          stats.effectiveDuration > 0) {
        final duration = stats.effectiveDuration.toDouble();
        speedKmh = (stats.distance / duration) * 3.6;
      }
    }

    final speedText = speedKmh != null
        ? '${speedKmh.toStringAsFixed(1)} ĞºĞ¼/Ñ‡'
        : 'â€”';

    Widget buildMetricItem(String label, Widget value) {
      return Column(
        crossAxisAlignment: itemCrossAxisAlignment,
        children: [
          Text(
            label,
            style: AppTextStyles.h11w4Sec.copyWith(
              color: textColor,
            ),
            textAlign: textAlign,
          ),
          const SizedBox(height: 1),
          Align(
            alignment: itemAlignment,
            child: value,
          ),
        ],
      );
    }

    final distanceValue = distanceText == 'â€”'
        ? Text(
            distanceText,
            style: AppTextStyles.h17w6.copyWith(
              color: textColor,
            ),
            textAlign: textAlign,
          )
        : Text.rich(
            TextSpan(
              children: [
                TextSpan(
                  text: distanceText
                      .replaceAll(' ĞºĞ¼', '')
                      .replaceAll(' Ğ¼', ''),
                  style: AppTextStyles.h17w6.copyWith(
                    color: textColor,
                  ),
                ),
                TextSpan(
                  text: distanceText.contains(' ĞºĞ¼') ? ' ĞºĞ¼' : ' Ğ¼',
                  style: AppTextStyles.h17w6.copyWith(
                    fontSize: 16,
                    color: textColor,
                  ),
                ),
              ],
            ),
            textAlign: textAlign,
          );

    final durationValue = Text(
      durationText,
      style: AppTextStyles.h17w6.copyWith(
        color: textColor,
      ),
      textAlign: textAlign,
    );

    final paceValue = isBike
        ? (speedText == 'â€”'
            ? Text(
                speedText,
                style: AppTextStyles.h17w6.copyWith(
                  color: textColor,
                ),
                textAlign: textAlign,
              )
            : Text.rich(
                TextSpan(
                  children: [
                    TextSpan(
                      text: speedText.replaceAll(' ĞºĞ¼/Ñ‡', ''),
                      style: AppTextStyles.h17w6.copyWith(
                        color: textColor,
                      ),
                    ),
                    TextSpan(
                      text: ' ĞºĞ¼/Ñ‡',
                      style: AppTextStyles.h17w6.copyWith(
                        fontSize: 16,
                        color: textColor,
                      ),
                    ),
                  ],
                ),
                textAlign: textAlign,
              ))
        : Text(
            paceText,
            style: AppTextStyles.h17w6.copyWith(
              color: textColor,
            ),
            textAlign: textAlign,
          );

    return Column(
      crossAxisAlignment: itemCrossAxisAlignment,
      children: [
        buildMetricItem('Ğ Ğ°ÑÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ', distanceValue),
        const SizedBox(height: 12),
        buildMetricItem('Ğ’Ñ€ĞµĞ¼Ñ, Ğ¼Ğ¸Ğ½', durationValue),
        const SizedBox(height: 12),
        buildMetricItem(
          isBike
              ? 'Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ'
              : isSwim
                  ? 'Ğ¢ĞµĞ¼Ğ¿, /100Ğ¼'
                  : 'Ğ¢ĞµĞ¼Ğ¿, /ĞºĞ¼',
          paceValue,
        ),
      ],
    );
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ”¹ ĞœĞ•Ğ¢Ğ Ğ˜ĞšĞ˜ Ğ¡ Ğ¦Ğ•ĞĞ¢Ğ Ğ˜Ğ ĞĞ’ĞĞĞ˜Ğ•Ğœ Ğ”Ğ›Ğ¯ 5-Ğ“Ğ Ğ’Ğ˜Ğ”Ğ
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Widget _buildOverlayMetricsColumnCentered(BuildContext context) {
    final textColor = isTextWhite
        ? Colors.white
        : AppColors.getTextPrimaryColor(context);
    final stats = activity.stats;
    final activityTypeLower = activity.type.toLowerCase();
    final isSwim =
        activityTypeLower == 'swim' || activityTypeLower == 'swimming';
    final isBike =
        activityTypeLower == 'bike' ||
        activityTypeLower == 'bicycle' ||
        activityTypeLower == 'cycling' ||
        activityTypeLower == 'indoor-cycling';

    String formatSwimDistance(double meters) {
      final value = meters.toStringAsFixed(0);
      final buffer = StringBuffer();
      for (int i = 0; i < value.length; i++) {
        if (i > 0 && (value.length - i) % 3 == 0) {
          buffer.write(' ');
        }
        buffer.write(value[i]);
      }
      return buffer.toString();
    }

    final distanceText = stats?.distance != null
        ? isSwim
            ? '${formatSwimDistance(stats!.distance)} Ğ¼'
            : '${(stats!.distance / 1000.0).toStringAsFixed(2)} ĞºĞ¼'
        : 'â€”';

    final durationText = stats?.effectiveDuration != null
        ? formatDuration(stats!.effectiveDuration)
        : 'â€”';

    String paceText;
    double? speedKmh;

    if (isSwim) {
      if (stats?.avgPace != null && stats!.avgPace > 0) {
        paceText = formatPace(stats.avgPace / 10.0);
      } else if (stats?.distance != null &&
          stats?.effectiveDuration != null &&
          stats!.distance > 0 &&
          stats.effectiveDuration > 0) {
        final duration = stats.effectiveDuration.toDouble();
        final paceMinPer100m = (duration * 100) / (stats.distance * 60);
        paceText = formatPace(paceMinPer100m);
      } else {
        paceText = 'â€”';
      }
    } else {
      paceText = stats?.avgPace != null ? formatPace(stats!.avgPace) : 'â€”';
    }

    if (isBike) {
      if (activity.points.isEmpty &&
          stats?.distance != null &&
          stats?.effectiveDuration != null &&
          stats!.distance > 0 &&
          stats.effectiveDuration > 0) {
        final duration = stats.effectiveDuration.toDouble();
        speedKmh = (stats.distance / duration) * 3.6;
      } else if (stats?.avgSpeed != null && stats!.avgSpeed > 0) {
        speedKmh = stats.avgSpeed;
      } else if (stats?.distance != null &&
          stats?.effectiveDuration != null &&
          stats!.distance > 0 &&
          stats.effectiveDuration > 0) {
        final duration = stats.effectiveDuration.toDouble();
        speedKmh = (stats.distance / duration) * 3.6;
      }
    } else {
      if (stats?.distance != null &&
          stats?.effectiveDuration != null &&
          stats!.distance > 0 &&
          stats.effectiveDuration > 0) {
        final duration = stats.effectiveDuration.toDouble();
        speedKmh = (stats.distance / duration) * 3.6;
      }
    }

    final speedText = speedKmh != null
        ? '${speedKmh.toStringAsFixed(1)} ĞºĞ¼/Ñ‡'
        : 'â€”';

    Widget buildMetricItem(String label, Widget value) {
      return Column(
        crossAxisAlignment: CrossAxisAlignment.center,
        children: [
          Text(
            label,
            style: AppTextStyles.h13w4Sec.copyWith(
              fontWeight: FontWeight.w500,
              color: textColor,
            ),
            textAlign: TextAlign.center,
          ),
          const SizedBox(height: 0),
          Center(
            child: value,
          ),
        ],
      );
    }

    final distanceValue = distanceText == 'â€”'
        ? Text(
            distanceText,
            style: AppTextStyles.h18w6.copyWith(
              fontSize: 24,
              fontWeight: FontWeight.w700,
              color: textColor,
            ),
            textAlign: TextAlign.center,
          )
        : Text.rich(
            TextSpan(
              children: [
                TextSpan(
                  text: distanceText
                      .replaceAll(' ĞºĞ¼', '')
                      .replaceAll(' Ğ¼', ''),
                  style: AppTextStyles.h18w6.copyWith(
                    fontSize: 24,
                    fontWeight: FontWeight.w700,
                    color: textColor,
                  ),
                ),
                TextSpan(
                  text: distanceText.contains(' ĞºĞ¼') ? ' ĞºĞ¼' : ' Ğ¼',
                  style: AppTextStyles.h18w6.copyWith(
                    fontSize: 20,
                    fontWeight: FontWeight.w700,
                    color: textColor,
                  ),
                ),
              ],
            ),
            textAlign: TextAlign.center,
          );

    final durationValue = Text(
      durationText,
      style: AppTextStyles.h18w6.copyWith(
        fontSize: 24,
        fontWeight: FontWeight.w700,
        color: textColor,
      ),
      textAlign: TextAlign.center,
    );

    final paceValue = isBike
        ? (speedText == 'â€”'
            ? Text(
                speedText,
                style: AppTextStyles.h18w6.copyWith(
                  fontSize: 24,
                  fontWeight: FontWeight.w700,
                  color: textColor,
                ),
                textAlign: TextAlign.center,
              )
            : Text.rich(
                TextSpan(
                  children: [
                    TextSpan(
                      text: speedText.replaceAll(' ĞºĞ¼/Ñ‡', ''),
                      style: AppTextStyles.h18w6.copyWith(
                        fontSize: 24,
                        fontWeight: FontWeight.w700,
                        color: textColor,
                      ),
                    ),
                    TextSpan(
                      text: ' ĞºĞ¼/Ñ‡',
                      style: AppTextStyles.h18w6.copyWith(
                        fontSize: 20,
                        fontWeight: FontWeight.w700,
                        color: textColor,
                      ),
                    ),
                  ],
                ),
                textAlign: TextAlign.center,
              ))
        : Text(
            paceText,
            style: AppTextStyles.h18w6.copyWith(
              fontSize: 24,
              fontWeight: FontWeight.w700,
              color: textColor,
            ),
            textAlign: TextAlign.center,
          );

    return Column(
      crossAxisAlignment: CrossAxisAlignment.center,
      children: [
        buildMetricItem('Ğ Ğ°ÑÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ', distanceValue),
        const SizedBox(height: 12),
        buildMetricItem('Ğ’Ñ€ĞµĞ¼Ñ', durationValue),
        const SizedBox(height: 12),
        buildMetricItem(
          isBike
              ? 'Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ'
              : isSwim
                  ? 'Ğ¢ĞµĞ¼Ğ¿, /100Ğ¼'
                  : 'Ğ¢ĞµĞ¼Ğ¿',
          paceValue,
        ),
      ],
    );
  }
}

/// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/// ğŸ”¹ Ğ¡Ğ•ĞšĞ¦Ğ˜Ğ¯ Ğ’Ğ«Ğ‘ĞĞ Ğ Ğ¤ĞĞ¢Ğ
/// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class _SharePhotoSelector extends StatelessWidget {
  final Activity activity;
  final List<_ShareMediaItem> items;
  final int selectedIndex;
  final ValueChanged<int> onSelected;

  const _SharePhotoSelector({
    required this.activity,
    required this.items,
    required this.selectedIndex,
    required this.onSelected,
  });

  @override
  Widget build(BuildContext context) {
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ”¹ ĞŸĞ£Ğ¡Ğ¢ĞĞ• Ğ¡ĞĞ¡Ğ¢ĞĞ¯ĞĞ˜Ğ•: ĞĞ•Ğ¢ Ğ¤ĞĞ¢Ğ Ğ˜ ĞĞ•Ğ¢ ĞœĞĞ Ğ¨Ğ Ğ£Ğ¢Ğ
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if (items.isEmpty) {
      return Text(
        'Ğ¤Ğ¾Ñ‚Ğ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ğ¹ Ğ½ĞµÑ‚',
        style: AppTextStyles.h14w4.copyWith(
          color: AppColors.getTextSecondaryColor(context),
        ),
      );
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ”¹ Ğ›Ğ•ĞĞ¢Ğ ĞœĞ˜ĞĞ˜ĞĞ¢Ğ®Ğ : ĞšĞĞš Ğ’ Ğ­ĞšĞ ĞĞĞ• Ğ Ğ•Ğ”ĞĞšĞ¢Ğ˜Ğ ĞĞ’ĞĞĞ˜Ğ¯
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    return LayoutBuilder(
      builder: (context, constraints) {
        final screenWidth = constraints.maxWidth;
        const separatorWidth = 12.0 * 2;
        final rawItemSize = (screenWidth - separatorWidth) / 3;
        final itemSize = (rawItemSize - 16).clamp(0.0, double.infinity);

        return SizedBox(
          height: itemSize,
          child: ListView.separated(
            scrollDirection: Axis.horizontal,
            physics: const BouncingScrollPhysics(),
            padding: const EdgeInsets.fromLTRB(16, 0, 16, 0),
            itemCount: items.length,
            separatorBuilder: (context, index) => const SizedBox(width: 12),
            itemBuilder: (context, index) {
              final item = items[index];
              final opacity = index == selectedIndex ? 1.0 : 0.5;
              final isOpacityAsset = item.isAsset &&
                  item.imageUrl == 'assets/opacity.jpg';

              return GestureDetector(
                onTap: () => onSelected(index),
                behavior: HitTestBehavior.opaque,
                child: Opacity(
                  opacity: opacity,
                  child: Stack(
                    children: [
                      item.isMap
                          ? _ShareMapItem(
                              points: activity.points
                                  .map((c) => LatLng(c.lat, c.lng))
                                  .toList(),
                              size: itemSize,
                            )
                          : _SharePhotoItem(
                              imageUrl: item.imageUrl!,
                              size: itemSize,
                              isAsset: item.isAsset,
                            ),
                      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                      // ğŸ”¹ Ğ¢Ğ•ĞšĞ¡Ğ¢ "ĞŸĞ ĞĞ—Ğ ĞĞ§ĞĞ«Ğ™ Ğ¤ĞĞ" Ğ”Ğ›Ğ¯ opacity.jpg
                      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                      if (isOpacityAsset)
                        Positioned.fill(
                          child: Center(
                            child: Text(
                              'ĞŸÑ€Ğ¾Ğ·Ñ€Ğ°Ñ‡Ğ½Ñ‹Ğ¹\nÑ„Ğ¾Ğ½',
                              style: AppTextStyles.h12w4.copyWith(
                                color: AppColors.surface,
                              ),
                              textAlign: TextAlign.center,
                            ),
                          ),
                        ),
                    ],
                  ),
                ),
              );
            },
          ),
        );
      },
    );
  }
}

/// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/// ğŸ”¹ Ğ­Ğ›Ğ•ĞœĞ•ĞĞ¢ Ğ¤ĞĞ¢Ğ: ĞœĞ˜ĞĞ˜ĞĞ¢Ğ®Ğ Ğ
/// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class _SharePhotoItem extends StatelessWidget {
  final String imageUrl;
  final double size;
  final bool isAsset;

  const _SharePhotoItem({
    required this.imageUrl,
    required this.size,
    this.isAsset = false,
  });

  @override
  Widget build(BuildContext context) {
    return SizedBox(
      width: size,
      height: size,
      child: ClipRRect(
        borderRadius: BorderRadius.circular(AppRadius.lg),
        child: isAsset
            ? Image.asset(
                imageUrl,
                fit: BoxFit.cover,
                errorBuilder: (context, error, stackTrace) => Container(
                  color: AppColors.twinphoto,
                  child: const Center(
                    child: Icon(
                      CupertinoIcons.photo,
                      size: 24,
                      color: AppColors.scrim20,
                    ),
                  ),
                ),
              )
            : Builder(
                builder: (context) {
                  final dpr = MediaQuery.of(context).devicePixelRatio;
                  final w = (size * dpr).round();

                  return CachedNetworkImage(
                    imageUrl: imageUrl,
                    fit: BoxFit.cover,
                    memCacheWidth: w,
                    maxWidthDiskCache: w,
                    placeholder: (context, url) => Container(
                      color: AppColors.twinphoto,
                      child: const Center(
                        child: CupertinoActivityIndicator(),
                      ),
                    ),
                    errorWidget: (context, url, error) => Container(
                      color: AppColors.twinphoto,
                      child: const Center(
                        child: Icon(
                          CupertinoIcons.photo,
                          size: 24,
                          color: AppColors.scrim20,
                        ),
                      ),
                    ),
                  );
                },
              ),
      ),
    );
  }
}

/// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/// ğŸ”¹ Ğ­Ğ›Ğ•ĞœĞ•ĞĞ¢ ĞšĞĞ Ğ¢Ğ«: ĞœĞ˜ĞĞ˜ĞĞ¢Ğ®Ğ Ğ
/// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class _ShareMapItem extends StatelessWidget {
  final List<LatLng> points;
  final double size;

  const _ShareMapItem({
    required this.points,
    required this.size,
  });

  @override
  Widget build(BuildContext context) {
    final dpr = MediaQuery.of(context).devicePixelRatio;
    final optimizedDpr = (dpr > 1.5 ? 1.5 : dpr).clamp(1.0, 1.5);
    final w = (size * optimizedDpr).round();
    final h = (size * optimizedDpr).round();

    final mapUrl = StaticMapUrlBuilder.fromPoints(
      points: points,
      widthPx: w.toDouble(),
      heightPx: h.toDouble(),
      strokeWidth: 3.0,
      padding: 10.0,
      maxWidth: 180.0,
      maxHeight: 180.0,
    );

    return SizedBox(
      width: size,
      height: size,
      child: ClipRRect(
        borderRadius: BorderRadius.circular(AppRadius.lg),
        child: CachedNetworkImage(
          imageUrl: mapUrl,
          fit: BoxFit.cover,
          memCacheWidth: w,
          memCacheHeight: h,
          maxWidthDiskCache: w,
          maxHeightDiskCache: h,
          placeholder: (context, url) => Container(
            color: AppColors.twinphoto,
            child: const Center(
              child: CupertinoActivityIndicator(),
            ),
          ),
          errorWidget: (context, url, error) => Container(
            color: AppColors.twinphoto,
            child: const Center(
              child: Icon(
                CupertinoIcons.map,
                size: 24,
                color: AppColors.scrim20,
              ),
            ),
          ),
        ),
      ),
    );
  }
}

/// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/// ğŸ”¹ ĞœĞĞ”Ğ•Ğ›Ğ¬ Ğ­Ğ›Ğ•ĞœĞ•ĞĞ¢Ğ ĞœĞ•Ğ”Ğ˜Ğ (Ğ¤ĞĞ¢Ğ Ğ˜Ğ›Ğ˜ ĞšĞĞ Ğ¢Ğ)
/// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class _ShareMediaItem {
  final String? imageUrl;
  final bool isMap;
  final bool isAsset;

  const _ShareMediaItem.photo(this.imageUrl)
      : isMap = false,
        isAsset = false;
  const _ShareMediaItem.asset(this.imageUrl)
      : isMap = false,
        isAsset = true;
  const _ShareMediaItem.map()
      : imageUrl = null,
        isMap = true,
        isAsset = false;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ğŸ”¹ Ğ¥Ğ•Ğ›ĞŸĞ•Ğ : Ğ¤ĞĞ ĞœĞ˜Ğ Ğ£Ğ•Ğœ Ğ¡ĞŸĞ˜Ğ¡ĞĞš ĞœĞ•Ğ”Ğ˜Ğ Ğ¡ Ğ£Ğ§Ğ•Ğ¢ĞĞœ Ğ¡ĞĞ Ğ¢Ğ˜Ğ ĞĞ’ĞšĞ˜ ĞšĞĞ Ğ¢Ğ«
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
List<_ShareMediaItem> _buildMediaItems(Activity activity) {
  final items = <_ShareMediaItem>[];

  for (final imageUrl in activity.mediaImages) {
    items.add(_ShareMediaItem.photo(imageUrl));
  }

  if (activity.points.isNotEmpty) {
    final mapInsertIndex =
        (activity.mapSortOrder ?? items.length).clamp(0, items.length);
    items.insert(mapInsertIndex, const _ShareMediaItem.map());
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ”¹ Ğ”ĞĞ‘ĞĞ’Ğ›Ğ¯Ğ•Ğœ ĞĞ¡Ğ¡Ğ•Ğ¢ opacity.jpg Ğ’ ĞšĞĞĞ•Ğ¦ Ğ¡ĞŸĞ˜Ğ¡ĞšĞ
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  items.add(const _ShareMediaItem.asset('assets/opacity.jpg'));

  return items;
}

/// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/// ğŸ”¹ ĞšĞĞ¡Ğ¢ĞĞœĞĞĞ¯ Ğ”ĞĞ ĞĞ–ĞšĞ Ğ¡Ğ›ĞĞ™Ğ”Ğ•Ğ Ğ Ğ¡ Ğ“Ğ ĞĞ”Ğ˜Ğ•ĞĞ¢ĞĞœ ĞĞ¢ Ğ‘Ğ•Ğ›ĞĞ“Ğ Ğ”Ğ Ğ§Ğ•Ğ ĞĞĞ“Ğ
/// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class _GradientSliderTrackShape extends SliderTrackShape
    with BaseSliderTrackShape {
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ”¹ CONST-ĞšĞĞĞ¡Ğ¢Ğ Ğ£ĞšĞ¢ĞĞ  Ğ”Ğ›Ğ¯ ĞŸĞ•Ğ Ğ•Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—ĞĞ’ĞĞĞ˜Ğ¯ Ğ˜ Ğ­ĞšĞĞĞĞœĞ˜Ğ˜ ĞĞ›Ğ›ĞĞšĞĞ¦Ğ˜Ğ™
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const _GradientSliderTrackShape();

  @override
  void paint(
    PaintingContext context,
    Offset offset, {
    required RenderBox parentBox,
    required SliderThemeData sliderTheme,
    required Animation<double> enableAnimation,
    required TextDirection textDirection,
    required Offset thumbCenter,
    Offset? secondaryOffset,
    bool isDiscrete = false,
    bool isEnabled = false,
    double additionalActiveTrackHeight = 2,
  }) {
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ”¹ Ğ ĞĞ¡Ğ§Ğ•Ğ¢ Ğ ĞĞ—ĞœĞ•Ğ ĞĞ’ Ğ”ĞĞ ĞĞ–ĞšĞ˜
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    final trackRect = getPreferredRect(
      parentBox: parentBox,
      offset: offset,
      sliderTheme: sliderTheme,
      isEnabled: isEnabled,
      isDiscrete: isDiscrete,
    );

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ”¹ Ğ Ğ˜Ğ¡Ğ£Ğ•Ğœ Ğ“Ğ ĞĞ”Ğ˜Ğ•ĞĞ¢ ĞĞ¢ Ğ‘Ğ•Ğ›ĞĞ“Ğ Ğ¡Ğ›Ğ•Ğ’Ğ Ğ”Ğ Ğ§Ğ•Ğ ĞĞĞ“Ğ Ğ¡ĞŸĞ ĞĞ’Ğ
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    final gradient = const LinearGradient(
      begin: Alignment.centerLeft,
      end: Alignment.centerRight,
      colors: [
        Colors.white,
        Colors.black,
      ],
      stops: [0.0, 1.0],
    );

    final gradientPaint = Paint()
      ..style = PaintingStyle.fill
      ..shader = gradient.createShader(trackRect);

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ”¹ Ğ Ğ˜Ğ¡Ğ£Ğ•Ğœ Ğ”ĞĞ ĞĞ–ĞšĞ£ Ğ¡ Ğ“Ğ ĞĞ”Ğ˜Ğ•ĞĞ¢ĞĞœ (Ğ¡ĞšĞ Ğ£Ğ“Ğ›Ğ•ĞĞĞ«Ğ• Ğ£Ğ“Ğ›Ğ«)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    final trackRRect = RRect.fromRectAndRadius(
      trackRect,
      Radius.circular(trackRect.height / 2),
    );

    context.canvas.drawRRect(trackRRect, gradientPaint);

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ”¹ Ğ Ğ˜Ğ¡Ğ£Ğ•Ğœ Ğ¢ĞĞĞšĞ£Ğ® ĞĞ‘Ğ’ĞĞ”ĞšĞ£ Ğ’ĞĞšĞ Ğ£Ğ“ Ğ”ĞĞ ĞĞ–ĞšĞ˜
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    final borderPaint = Paint()
      ..color = Colors.grey.withValues(alpha: 0.3)
      ..style = PaintingStyle.stroke
      ..strokeWidth = 1.0;

    context.canvas.drawRRect(trackRRect, borderPaint);
  }
}
