// ─────────────────────────────────────────────────────────────────────────────
//  PACEUP — GENERATE INVESTOR PDFs (DECK + BUSINESS PLAN)
//
//  ВАЖНО:
//  - Скрипт генерирует 2 PDF файла в папку `investor/`:
//      - investor/paceup_deck.pdf
//      - investor/paceup_business_plan.pdf
//  - Все цифры внутри — ДОПУЩЕНИЯ (черновик) и требуют валидации.
//
//  Почему Dart:
//  - В окружении есть Flutter/Dart SDK (см. flutter --version),
//    а Python/Node могут отсутствовать.
//
// ─────────────────────────────────────────────────────────────────────────────

import 'dart:convert';
import 'dart:io';
import 'dart:typed_data';

import 'package:pdf/pdf.dart';
import 'package:pdf/widgets.dart' as pw;

// ─────────────────────────────────────────────────────────────────────────────
//                               ПУТИ / ТЕМЫ
// ─────────────────────────────────────────────────────────────────────────────

final _root = Directory.current;
final _investorDir = Directory('${_root.path}/investor');

final _logoPath = File('${_root.path}/assets/logo.png');

final _fontRegularPath = File('${_root.path}/fonts/Inter-Regular.ttf');
final _fontMediumPath = File('${_root.path}/fonts/Inter-Medium.ttf');
final _fontSemiBoldPath = File('${_root.path}/fonts/Inter-SemiBold.ttf');
final _fontBoldPath = File('${_root.path}/fonts/Inter-Bold.ttf');

// Цвет бренда из `AppColors.brandPrimary` (см. lib/core/theme/colors.dart).
const _brandPrimary = PdfColor.fromInt(0xFF379AE6);

// 16:9 «слайдовый» формат в PDF-поинтах (1/72 inch).
const _deckFormat = PdfPageFormat(960, 540);

// ─────────────────────────────────────────────────────────────────────────────
//                              ВСПОМОГАТЕЛЬНОЕ
// ─────────────────────────────────────────────────────────────────────────────

void _mustExist(File f) {
  // ─────────────────────────────────────────────────────────────────────────
  // Проверка обязательных ресурсов.
  //
  // Зачем:
  // - Логотип и Inter — ключ к «брендовому» виду PDF.
  // - Лучше упасть с понятной ошибкой, чем создать пустой/битый файл.
  // ─────────────────────────────────────────────────────────────────────────
  if (!f.existsSync()) {
    throw FileSystemException('Не найден файл', f.path);
  }
}

Uint8List _readBytes(File f) => f.readAsBytesSync();

pw.TextStyle _t(
  pw.Font font,
  double size, {
  PdfColor color = PdfColors.black,
  double? height,
}) {
  // ─────────────────────────────────────────────────────────────────────────
  // Короткий хелпер для типографики.
  // ─────────────────────────────────────────────────────────────────────────
  return pw.TextStyle(
    font: font,
    fontSize: size,
    color: color,
    height: height,
  );
}

// ─────────────────────────────────────────────────────────────────────────────
//                                 PITCH DECK
// ─────────────────────────────────────────────────────────────────────────────

class _Slide {
  final String title;
  final List<String> bullets;
  final String? footerNote;

  const _Slide({
    required this.title,
    required this.bullets,
    this.footerNote,
  });
}

List<_Slide> _buildDeckSlides() {
  // ─────────────────────────────────────────────────────────────────────────
  // Слайды: коротко, по-деловому, инвесторский формат.
  // ─────────────────────────────────────────────────────────────────────────
  return const [
    _Slide(
      title: 'PaceUp: тренировки → соцмотивация → события → сделки',
      bullets: [
        'Россия: доступно nationwide, рост через 10–20 якорных городов',
        'Авто‑контент: импорт тренировок (Health Connect + Strava)',
        'Маркет: слоты на старты + экипировка + чаты сделок',
      ],
      footerNote: 'Все цифры — допущения (черновик) и требуют валидации.',
    ),
    _Slide(
      title: 'Проблема',
      bullets: [
        'Мотивация и удержание ломаются без сообщества',
        'События/клубы фрагментированы по каналам',
        'Вторичный рынок слотов/экипировки — хаотичен и без доверия',
      ],
    ),
    _Slide(
      title: 'Решение',
      bullets: [
        'Лента тренировок/постов + подписки/соцграф',
        'Карта событий и клубов',
        'Маркет слотов и вещей + сделки в чате',
        'Уведомления и алерты',
      ],
    ),
    _Slide(
      title: 'Почему сейчас',
      bullets: [
        'Рост трекеров и Health Connect',
        'Спрос на локальные активности и комьюнити',
        'Ожидание fast UX (offline-first стандарт)',
      ],
    ),
    _Slide(
      title: 'Что уже сделано (MVP)',
      bullets: [
        'Лента: пагинация, дедупликация, refresh',
        'Импорт: Health Connect + Strava, маршруты Android',
        'Карта: события/клубы, кластеризация',
        'Маркет: слоты/вещи, чаты, статусы сделок, алерты',
      ],
    ),
    _Slide(
      title: 'Дифференциаторы',
      bullets: [
        'Авто‑контент → быстрый “aha moment”',
        'Локальный слой: события/клубы + вторичка слотов',
        'Инженерная база: offline-first + unified image cache',
      ],
    ),
    _Slide(
      title: 'Бизнес‑модель',
      bullets: [
        'Комиссия/платное продвижение в маркете',
        'Affiliate (экипировка/старты)',
        'Подписка PacePro (премиум‑фичи)',
        'Реклама/спонсоры (после масштаба)',
      ],
    ),
    _Slide(
      title: 'Go‑To‑Market (вся РФ)',
      bullets: [
        'Nationwide distribution с первого дня',
        'Рост/партнёрства: 10–20 якорных городов',
        '300k–1 млн ₽/мес первые 3 месяца: performance + инфлюенсеры',
      ],
    ),
    _Slide(
      title: 'KPI (цели, допущения)',
      bullets: [
        'Activation: 30% подключили трекер, 20% импортировали 1 тренировку за 48ч',
        'Retention: D7 20–30%, D30 10–15%',
        'Marketplace: просмотр→чат→резерв→сделка, GMV, take rate',
      ],
    ),
    _Slide(
      title: 'Риски и план закрытия',
      bullets: [
        'Авторизация/токены: убрать временные заглушки до релиза',
        'Модерация маркета: правила, репорты, анти‑фрод',
        'Push+аналитика: базовый слой для управления продуктом',
      ],
    ),
    _Slide(
      title: 'Roadmap 12 месяцев',
      bullets: [
        '0–2 мес: релизная готовность + онбординг импорта',
        '2–6 мес: рост в якорных городах + монетизация маркета',
        '6–12 мес: PacePro + партнёрки/спонсоры',
      ],
    ),
    _Slide(
      title: 'Раунд',
      bullets: [
        'Pre‑seed: 5–20 млн ₽',
        'Цель: PMF‑сигнал и unit‑экономика по маркете/Pro',
        'Runway: 9–15 месяцев (зависит от найма)',
      ],
    ),
  ];
}

pw.Widget _deckSlidePage({
  required pw.MemoryImage logo,
  required pw.Font regular,
  required pw.Font semiBold,
  required pw.Font bold,
  required _Slide slide,
  required int index,
  required int total,
}) {
  // ─────────────────────────────────────────────────────────────────────────
  // Одна страница deck (слайд).
  // ─────────────────────────────────────────────────────────────────────────
  return pw.Container(
    padding: const pw.EdgeInsets.all(40),
    child: pw.Column(
      crossAxisAlignment: pw.CrossAxisAlignment.start,
      children: [
        // ───────────── Header ─────────────
        pw.Row(
          crossAxisAlignment: pw.CrossAxisAlignment.center,
          children: [
            pw.Container(
              width: 56,
              height: 56,
              decoration: pw.BoxDecoration(
                borderRadius: pw.BorderRadius.circular(10),
              ),
              child: pw.Image(logo, fit: pw.BoxFit.cover),
            ),
            pw.SizedBox(width: 14),
            pw.Column(
              crossAxisAlignment: pw.CrossAxisAlignment.start,
              children: [
                pw.Text('PaceUp', style: _t(bold, 26)),
                pw.Text(
                  'Investor deck (черновик)',
                  style: _t(semiBold, 12, color: _brandPrimary),
                ),
              ],
            ),
            pw.Spacer(),
            pw.Text(
              '$index/$total',
              style: _t(regular, 10, color: PdfColors.grey700),
            ),
          ],
        ),
        pw.SizedBox(height: 42),

        // ───────────── Title ─────────────
        pw.Text(slide.title, style: _t(bold, 30)),
        pw.SizedBox(height: 22),

        // ───────────── Bullets ─────────────
        pw.Column(
          crossAxisAlignment: pw.CrossAxisAlignment.start,
          children: [
            for (final b in slide.bullets)
              pw.Padding(
                padding: const pw.EdgeInsets.only(bottom: 14),
                child: pw.Row(
                  crossAxisAlignment: pw.CrossAxisAlignment.start,
                  children: [
                    pw.Text('•  ', style: _t(semiBold, 18)),
                    pw.Expanded(
                      child: pw.Text(
                        b,
                        style: _t(regular, 18, height: 1.25),
                      ),
                    ),
                  ],
                ),
              ),
          ],
        ),

        pw.Spacer(),
        if (slide.footerNote != null)
          pw.Text(
            slide.footerNote!,
            style: _t(regular, 10, color: PdfColors.grey700),
          ),
      ],
    ),
  );
}

Future<void> _buildDeckPdf({
  required pw.MemoryImage logo,
  required pw.Font regular,
  required pw.Font semiBold,
  required pw.Font bold,
  required File outFile,
}) async {
  // ─────────────────────────────────────────────────────────────────────────
  // Сборка PDF deck: каждая страница = отдельный «слайд».
  // ─────────────────────────────────────────────────────────────────────────
  final pdf = pw.Document(
    title: 'PaceUp — Investor Deck (draft)',
    author: 'PaceUp',
  );

  final slides = _buildDeckSlides();
  for (var i = 0; i < slides.length; i++) {
    final slide = slides[i];
    pdf.addPage(
      pw.Page(
        pageFormat: _deckFormat,
        build: (_) => _deckSlidePage(
          logo: logo,
          regular: regular,
          semiBold: semiBold,
          bold: bold,
          slide: slide,
          index: i + 1,
          total: slides.length,
        ),
      ),
    );
  }

  final bytes = await pdf.save();
  outFile.writeAsBytesSync(bytes);
}

// ─────────────────────────────────────────────────────────────────────────────
//                              BUSINESS PLAN (A4)
// ─────────────────────────────────────────────────────────────────────────────

pw.Widget _h2(String t, pw.Font semiBold) {
  // ─────────────────────────────────────────────────────────────────────────
  // Заголовок секции в полном бизнес‑плане.
  // ─────────────────────────────────────────────────────────────────────────
  return pw.Padding(
    padding: const pw.EdgeInsets.only(top: 12, bottom: 6),
    child: pw.Text(
      t,
      style: _t(semiBold, 16),
    ),
  );
}

pw.Widget _p(String t, pw.Font regular) => pw.Padding(
      padding: const pw.EdgeInsets.only(bottom: 6),
      child: pw.Text(t, style: _t(regular, 11, height: 1.35)),
    );

pw.Widget _ul(List<String> items, pw.Font regular, pw.Font semiBold) {
  // ─────────────────────────────────────────────────────────────────────────
  // Bullet list для A4 документа.
  // ─────────────────────────────────────────────────────────────────────────
  return pw.Column(
    crossAxisAlignment: pw.CrossAxisAlignment.start,
    children: [
      for (final it in items)
        pw.Padding(
          padding: const pw.EdgeInsets.only(bottom: 4),
          child: pw.Row(
            crossAxisAlignment: pw.CrossAxisAlignment.start,
            children: [
              pw.Text('•  ', style: _t(semiBold, 11)),
              pw.Expanded(child: pw.Text(it, style: _t(regular, 11, height: 1.3))),
            ],
          ),
        ),
    ],
  );
}

pw.Widget _table({
  required List<List<String>> rows,
  required pw.Font regular,
  required pw.Font semiBold,
}) {
  // ─────────────────────────────────────────────────────────────────────────
  // Простая таблица с брендовой шапкой.
  // ─────────────────────────────────────────────────────────────────────────
  return pw.Table(
    border: pw.TableBorder.all(color: PdfColors.grey300, width: 0.6),
    columnWidths: const {},
    children: [
      for (var r = 0; r < rows.length; r++)
        pw.TableRow(
          decoration: r == 0
              ? const pw.BoxDecoration(color: _brandPrimary)
              : null,
          children: [
            for (final cell in rows[r])
              pw.Padding(
                padding: const pw.EdgeInsets.all(6),
                child: pw.Text(
                  cell,
                  style: r == 0
                      ? _t(semiBold, 10, color: PdfColors.white)
                      : _t(regular, 10, height: 1.25),
                ),
              ),
          ],
        ),
    ],
  );
}

Future<void> _buildBusinessPlanPdf({
  required pw.MemoryImage logo,
  required pw.Font regular,
  required pw.Font medium,
  required pw.Font semiBold,
  required pw.Font bold,
  required File outFile,
}) async {
  // ─────────────────────────────────────────────────────────────────────────
  // Полный бизнес‑план: MultiPage A4.
  // ─────────────────────────────────────────────────────────────────────────
  final pdf = pw.Document(
    title: 'PaceUp — Business Plan (draft)',
    author: 'PaceUp',
  );

  pdf.addPage(
    pw.MultiPage(
      pageFormat: PdfPageFormat.a4,
      margin: const pw.EdgeInsets.fromLTRB(36, 36, 36, 36),
      footer: (context) => pw.Container(
        margin: const pw.EdgeInsets.only(top: 10),
        child: pw.Row(
          children: [
            pw.Expanded(
              child: pw.Container(
                height: 2,
                color: _brandPrimary,
              ),
            ),
            pw.SizedBox(width: 10),
            pw.Text(
              'стр. ${context.pageNumber}',
              style: _t(regular, 9, color: PdfColors.grey700),
            ),
          ],
        ),
      ),
      build: (_) {
        final today = DateTime.now();

        return [
          // ───────────── Cover ─────────────
          pw.Row(
            children: [
              pw.Container(
                width: 56,
                height: 56,
                child: pw.Image(logo, fit: pw.BoxFit.cover),
              ),
              pw.SizedBox(width: 14),
              pw.Column(
                crossAxisAlignment: pw.CrossAxisAlignment.start,
                children: [
                  pw.Text('PaceUp', style: _t(bold, 24)),
                  pw.Text(
                    'Бизнес‑план для инвестора (черновик)',
                    style: _t(semiBold, 12, color: _brandPrimary),
                  ),
                ],
              ),
            ],
          ),
          pw.SizedBox(height: 16),
          _p(
            'Дата: ${today.day.toString().padLeft(2, '0')}.'
            '${today.month.toString().padLeft(2, '0')}.'
            '${today.year} · География: Россия · Стадия: MVP (pre‑launch) · '
            'Раунд: Pre‑seed 5–20 млн ₽',
            regular,
          ),
          pw.SizedBox(height: 10),
          _ul(
            [
              'Мультиспорт: бег / вело / плавание',
              'Nationwide доступность + рост через 10–20 якорных городов',
              'Авто‑контент: импорт тренировок (Health Connect + Strava)',
              'Маркет: слоты на старты и экипировка + чаты сделок',
            ],
            regular,
            semiBold,
          ),
          pw.SizedBox(height: 18),
          pw.Container(
            padding: const pw.EdgeInsets.all(10),
            decoration: pw.BoxDecoration(
              color: PdfColors.grey100,
              borderRadius: pw.BorderRadius.circular(8),
              border: pw.Border.all(color: PdfColors.grey300),
            ),
            child: pw.Text(
              'Дисклеймер: все цифры, рынки, KPI и финмодель в этом документе '
              'являются допущениями (черновик) и требуют валидации на фактах.',
              style: _t(regular, 10, color: PdfColors.grey800, height: 1.35),
            ),
          ),
          pw.SizedBox(height: 18),

          // ───────────── Sections ─────────────
          _h2('1. Executive Summary', semiBold),
          _p(
            'PaceUp — это спортивная платформа нового поколения, объединяющая тренировки, '
            'социальную мотивацию, локальные события и сделки в едином продукте. Мы решаем '
            'проблему фрагментации спортивного сообщества, предоставляя пользователям '
            'автоматический импорт тренировок, карту событий и клубов, а также маркетплейс '
            'для слотов на старты и экипировки.',
            regular,
          ),
          pw.SizedBox(height: 8),
          _p(
            'Наш подход — nationwide distribution с первого дня запуска, с фокусом на рост '
            'и партнёрства в 10–20 якорных городах России. Монетизация строится на '
            'комиссиях с транзакций маркетплейса, affiliate-программах, подписке PacePro '
            'и рекламе после достижения масштаба.',
            regular,
          ),
          pw.SizedBox(height: 8),
          _p(
            'Мы ищем Pre‑seed инвестиции в размере 5–20 млн ₽ для достижения PMF-сигналов '
            'и подтверждения unit-экономики в течение 9–15 месяцев.',
            regular,
          ),

          _h2('2. Проблема и решение', semiBold),
          _p(
            '2.1. Проблемы рынка:',
            semiBold,
          ),
          _ul(
            [
              'Мотивация и удержание спортсменов-любителей ломается без сообщества и обратной связи. Большинство бросает тренировки в первые 3 месяца из-за отсутствия поддержки и видимого прогресса.',
              'События, клубы и коммуникации разбросаны по разным каналам: соцсети, мессенджеры, сайты организаторов. Нет единой точки входа для поиска локальных активностей.',
              'Вторичный рынок слотов на старты и экипировки хаотичен и небезопасен. Пользователи вынуждены искать предложения в группах соцсетей без гарантий и удобных инструментов сделок.',
              'Тренировочные данные хранятся в разных приложениях (Strava, Garmin, Apple Health), что усложняет анализ прогресса и соревновательный элемент.',
            ],
            regular,
            semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '2.2. Решение PaceUp:',
            semiBold,
          ),
          _ul(
            [
              'Автоматический импорт тренировок из Health Connect (Android) и Strava создаёт мгновенный "aha moment" — пользователь видит свой контент без ручного ввода.',
              'Лента тренировок и постов с подписками формирует социальный граф и мотивацию через сравнение и поддержку сообщества.',
              'Карта событий и клубов с кластеризацией маркеров даёт единую точку поиска локальных активностей.',
              'Маркетплейс слотов и экипировки с встроенными чатами и статусами сделок решает проблему доверия и удобства транзакций.',
              'Offline-first архитектура обеспечивает мгновенную загрузку и работу без интернета, что критично для спортивных приложений.',
            ],
            regular,
            semiBold,
          ),

          _h2('3. Продукт (MVP)', semiBold),
          _p(
            '3.1. Лента активности:',
            semiBold,
          ),
          _ul(
            [
              'Бесконечная лента тренировок и постов с курсорной пагинацией и дедупликацией по ID.',
              'Pull-to-refresh для обновления контента без потери позиции скролла.',
              'Лайки, комментарии и подписки для формирования социального графа.',
              'Кэширование в Drift (SQLite) для мгновенной загрузки и офлайн-режима.',
            ],
            regular,
            semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '3.2. Импорт тренировок:',
            semiBold,
          ),
          _ul(
            [
              'Health Connect (Android): автоматическая синхронизация новых тренировок с извлечением дистанции, пульса, каденса, калорий и GPS-маршрута через MethodChannel.',
              'Strava: серверная синхронизация через API endpoint с поддержкой всех типов активностей.',
              'Онбординг с пошаговыми инструкциями для подключения трекеров и первого импорта.',
            ],
            regular,
            semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '3.3. Карта событий и клубов:',
            semiBold,
          ),
          _ul(
            [
              'Интеграция Mapbox и MapTiler для отображения карт с кластеризацией маркеров через GeoJSON источники.',
              'Фильтрация по типам событий (бег, вело, плавание) и датам.',
              'Статические OSM-карты для маршрутов тренировок с полилиниями в brandPrimary цвете.',
            ],
            regular,
            semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '3.4. Маркетплейс:',
            semiBold,
          ),
          _ul(
            [
              'Два типа товаров: "Слоты" (места на старты) и "Вещи" (экипировка).',
              'Фильтрация по категориям, цене, расстоянию и статусу.',
              'Встроенные чаты для обсуждения сделок с уведомлениями о новых сообщениях.',
              'Статусы сделок: резерв, оплата, завершено, отменено.',
              'Алерты на новые слоты по выбранным событиям и расстоянию.',
            ],
            regular,
            semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '3.5. Дополнительные функции:',
            semiBold,
          ),
          _ul(
            [
              'Профиль пользователя с табами: главная, фото, статистика, тренировки, старты, экипировка, клубы, награды, навыки.',
              'Задачи (Tasks) с активными и доступными категориями для геймификации.',
              'Лидерборды по подпискам, всем пользователям и городам с фильтрацией по спорту, периоду, полу и параметру.',
              'Уведомления и бейджи непрочитанных сообщений и алертов.',
            ],
            regular,
            semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '3.6. Техническая база:',
            semiBold,
          ),
          _ul(
            [
              'Offline-first кэширование через Drift (SQLite) для ленты, профилей и маршрутов.',
              'Unified image cache с пропорциональным ресайзингом для оптимизации памяти и трафика.',
              'API Service с connection pooling, retry logic (exponential backoff) и автоматическим добавлением токенов.',
              'Riverpod для state management с генерацией провайдеров через аннотации.',
            ],
            regular,
            semiBold,
          ),

          _h2('4. Рынок (TAM/SAM/SOM)', semiBold),
          _p(
            'Ниже представлены три сценария оценки рынка. Все цифры являются допущениями '
            'и требуют валидации через маркетинговые исследования и аналитику после запуска.',
            regular,
          ),
          pw.SizedBox(height: 8),
          _table(
            rows: const [
              ['Метрика', 'Консервативно', 'Базово', 'Агрессивно'],
              ['TAM: спорт-активные пользователи смартфонов в РФ', '12 млн', '20 млн', '30 млн'],
              ['SAM: мультиспорт аудитория (бег/вело/плавание)', '3 млн', '6 млн', '10 млн'],
              ['SOM (12 мес): достижимые MAU', '30k', '80k', '200k'],
              ['SOM (24 мес): достижимые MAU', '100k', '300k', '800k'],
            ],
            regular: regular,
            semiBold: semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '4.1. Сегментация аудитории:',
            semiBold,
          ),
          _ul(
            [
              'B2C Amateur: любители, которые тренируются 1–3 раза в неделю для здоровья и удовольствия. Цель — мотивация и сообщество.',
              'B2C Serious: серьёзные спортсмены, тренирующиеся 4+ раз в неделю с целями участия в соревнованиях. Цель — анализ прогресса и поиск стартов.',
              'Клубы: спортивные клубы и сообщества, нуждающиеся в инструментах для организации тренировок и привлечения участников.',
              'Организаторы событий: компании, проводящие старты и нуждающиеся в продвижении и продаже слотов.',
              'Тренеры: индивидуальные тренеры, ищущие клиентов и инструменты для отслеживания прогресса подопечных.',
              'Бренды: производители экипировки и спонсоры, заинтересованные в таргетированной рекламе и affiliate-программах.',
            ],
            regular,
            semiBold,
          ),

          _h2('5. Монетизация (по фазам)', semiBold),
          _p(
            '5.1. Фаза A (0–6 месяцев): Marketplace и Affiliate',
            semiBold,
          ),
          _ul(
            [
              'Take rate 3–7% с транзакций маркетплейса (слоты и экипировка). При среднем чеке 2000–5000 ₽ и 100–500 транзакций в месяц это даёт 6k–175k ₽/мес (допущение).',
              'Платные бусты листингов в маркетплейсе: 99–299 ₽ за поднятие объявления в топ на 7 дней. Целевая конверсия: 5–10% продавцов используют бусты.',
              'Affiliate-программы с производителями экипировки и организаторами стартов: 5–15% с продаж. При GMV 500k–2 млн ₽/мес это 25k–300k ₽/мес (допущение).',
            ],
            regular,
            semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '5.2. Фаза B (6–12 месяцев): PacePro подписка',
            semiBold,
          ),
          _ul(
            [
              'Премиум-подписка PacePro: 199 ₽/мес или 1490 ₽/год (экономия 2 месяца).',
              'Премиум-функции: расширенная аналитика, приоритетная поддержка, безлимитные алерты, продвижение профиля, эксклюзивные задачи и награды.',
              'Целевая конверсия: 1–3% от MAU при достижении 50k+ активных пользователей. При 50k MAU и 2% конверсии это 1000 подписок × 199 ₽ = 199k ₽/мес (допущение).',
            ],
            regular,
            semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '5.3. Фаза C (12+ месяцев): Реклама и спонсорство',
            semiBold,
          ),
          _ul(
            [
              'Нативная реклама в ленте от брендов экипировки и организаторов событий: 50k–200k ₽ за размещение на месяц (допущение).',
              'Спонсорство лидербордов и задач: 100k–500k ₽ за кампанию (допущение).',
              'Партнёрские программы с крупными событиями и клубами: revenue share 10–20% (допущение).',
            ],
            regular,
            semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '5.4. Прогноз выручки (допущения):',
            semiBold,
          ),
          _table(
            rows: const [
              ['Месяц', 'MAU', 'Marketplace', 'PacePro', 'Affiliate', 'Реклама', 'Итого/мес'],
              ['3', '5k', '10k', '0', '15k', '0', '25k'],
              ['6', '20k', '50k', '0', '50k', '0', '100k'],
              ['9', '50k', '150k', '100k', '100k', '0', '350k'],
              ['12', '80k', '250k', '200k', '150k', '50k', '650k'],
              ['18', '150k', '500k', '450k', '300k', '150k', '1.4M'],
              ['24', '300k', '1M', '900k', '600k', '300k', '2.8M'],
            ],
            regular: regular,
            semiBold: semiBold,
          ),

          _h2('6. Go‑To‑Market: Nationwide + фокус городов', semiBold),
          _p(
            '6.1. Стратегия запуска:',
            semiBold,
          ),
          _ul(
            [
              'Nationwide distribution с первого дня: приложение доступно для скачивания по всей России через App Store и Google Play.',
              'Фокус на рост и партнёрства в 10–20 якорных городах: Москва, СПб, Казань, Екатеринбург, Новосибирск, Нижний Новгород, Краснодар, Ростов-на-Дону, Самара, Уфа, Челябинск, Воронеж, Пермь, Волгоград, Омск, Красноярск, Воронеж, Иркутск, Тюмень, Сочи.',
              'Критерии выбора якорных городов: плотность стартов и клубов, активность в Strava и соцсетях, наличие инфлюенсеров и медиа-партнёров.',
            ],
            regular,
            semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '6.2. Маркетинговый бюджет и каналы (первые 3 месяца):',
            semiBold,
          ),
          _ul(
            [
              'Бюджет: 300k–1 млн ₽/мес в зависимости от раунда (Lean vs Growth).',
              'Performance-маркетинг (40–50% бюджета): таргетированная реклама в VK, Яндекс.Директ, myTarget с фокусом на аудиторию 25–45 лет, интересующуюся спортом.',
              'Инфлюенсеры (20–30% бюджета): партнёрства с бегунами, велосипедистами и триатлетами с аудиторией 10k–100k подписчиков. Формат: обзоры, челленджи, промокоды.',
              'Партнёрства (15–20% бюджета): сотрудничество с клубами, организаторами стартов и магазинами экипировки для кросс-промо и реферальных программ.',
              'Контент-маркетинг (10–15% бюджета): статьи, видео и посты о тренировках, событиях и экипировке для привлечения органического трафика.',
            ],
            regular,
            semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '6.3. KPI по каналам (цели, допущения):',
            semiBold,
          ),
          _table(
            rows: const [
              ['Канал', 'CAC (допущение)', 'Конверсия в установку', 'D7 Retention'],
              ['Performance', '200–500 ₽', '2–5%', '25–35%'],
              ['Инфлюенсеры', '150–400 ₽', '3–7%', '30–40%'],
              ['Партнёрства', '100–300 ₽', '5–10%', '35–45%'],
              ['Органика', '50–150 ₽', '1–3%', '20–30%'],
            ],
            regular: regular,
            semiBold: semiBold,
          ),

          _h2('7. KPI и метрики продукта', semiBold),
          _p(
            '7.1. Activation (первые 48 часов):',
            semiBold,
          ),
          _ul(
            [
              '≥30% пользователей подключили трекер (Health Connect или Strava) в течение первого сеанса.',
              '≥20% пользователей импортировали хотя бы одну тренировку за первые 48 часов после установки.',
              '≥15% пользователей создали первый пост или оставили комментарий в течение недели.',
            ],
            regular,
            semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '7.2. Retention (удержание):',
            semiBold,
          ),
          _ul(
            [
              'D1 (день 1): 50–60% пользователей возвращаются на следующий день.',
              'D7 (день 7): 20–30% пользователей активны через неделю после установки.',
              'D30 (день 30): 10–15% пользователей остаются активными через месяц.',
              'D90 (день 90): 5–8% пользователей формируют ядро долгосрочной аудитории.',
            ],
            regular,
            semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '7.3. Marketplace метрики:',
            semiBold,
          ),
          _ul(
            [
              '≥3–7% активных пользователей инициируют чат сделки в месяц (просмотр → чат).',
              'Конверсия чат → резерв: 30–50% (допущение).',
              'Конверсия резерв → оплата: 60–80% (допущение).',
              'Средний чек транзакции: 2000–5000 ₽ (допущение).',
              'Take rate: 3–7% с каждой успешной сделки.',
            ],
            regular,
            semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '7.4. PacePro конверсия:',
            semiBold,
          ),
          _ul(
            [
              'При MAU 50k+: целевая конверсия в подписку 1–3% (500–1500 подписок).',
              'При MAU 100k+: целевая конверсия 2–4% (2000–4000 подписок).',
              'Churn rate (отток): ≤5% в месяц для здоровой unit-экономики.',
            ],
            regular,
            semiBold,
          ),

          _h2('8. Конкурентный анализ', semiBold),
          _p(
            '8.1. Прямые конкуренты:',
            semiBold,
          ),
          _ul(
            [
              'Strava: мировой лидер в трекинге тренировок с сильным социальным компонентом. Сильные стороны: большая база пользователей, интеграции с устройствами. Слабые: нет маркетплейса, слабая локализация для России, нет фокуса на локальных событиях.',
              'Garmin Connect: экосистема для владельцев устройств Garmin. Сильные: точные данные, аналитика. Слабые: привязанность к устройствам, слабый социальный компонент, нет маркетплейса.',
              'Nike Run Club / Adidas Running: брендовые приложения с мотивацией. Сильные: бренд, геймификация. Слабые: фокус только на беге, нет маркетплейса, слабая локализация.',
            ],
            regular,
            semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '8.2. Косвенные конкуренты:',
            semiBold,
          ),
          _ul(
            [
              'Группы в соцсетях (VK, Telegram): для поиска событий и покупки слотов. Сильные: бесплатность, простота. Слабые: нет структуры, риски мошенничества, нет автоматизации.',
              'Сайты организаторов стартов: для регистрации на события. Сильные: официальность. Слабые: фрагментация, нет единой точки входа, нет вторичного рынка.',
              'Avito / Юла: для покупки экипировки. Сильные: большой выбор. Слабые: нет спортивного контекста, нет доверия, нет интеграции с тренировками.',
            ],
            regular,
            semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '8.3. Наши дифференциаторы:',
            semiBold,
          ),
          _ul(
            [
              'Автоматический импорт тренировок создаёт мгновенный "aha moment" без ручного ввода данных.',
              'Маркетплейс слотов и экипировки с встроенными чатами решает проблему вторичного рынка в спорте.',
              'Фокус на локальных событиях и клубах через карту с кластеризацией.',
              'Offline-first архитектура обеспечивает мгновенную загрузку и работу без интернета.',
              'Мультиспорт подход (бег, вело, плавание) в одном приложении.',
              'Nationwide доступность с первого дня с фокусом на российский рынок.',
            ],
            regular,
            semiBold,
          ),

          _h2('9. Риски и план их закрытия', semiBold),
          _p(
            '9.1. Технические риски:',
            semiBold,
          ),
          _ul(
            [
              'Auth/токены: в MVP используются временные заглушки. План: внедрить полноценную SMS-авторизацию с безопасным хранением access/refresh токенов через FlutterSecureStorage до релиза.',
              'Масштабирование API: текущий бэкенд может не выдержать нагрузку при росте. План: мониторинг метрик, горизонтальное масштабирование, кэширование на уровне API.',
              'Синхронизация данных: конфликты при офлайн-редактировании. План: реализовать optimistic updates и conflict resolution через версионирование.',
            ],
            regular,
            semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '9.2. Продуктовые риски:',
            semiBold,
          ),
          _ul(
            [
              'Модерация маркетплейса: риск мошенничества и некачественных товаров. План: правила размещения, система репортов, верификация продавцов, рейтинги и отзывы, анти-фрод алгоритмы.',
              'Качество контента в ленте: спам и низкокачественные посты. План: алгоритмическая лента с релевантностью, модерация контента, возможность скрытия постов.',
              'Удержание пользователей: риск низкого retention без достаточной активности сообщества. План: онбординг импорта, push-уведомления о подписках и событиях, геймификация через задачи и лидерборды.',
            ],
            regular,
            semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '9.3. Бизнес-риски:',
            semiBold,
          ),
          _ul(
            [
              'Низкая конверсия в монетизацию: пользователи не готовы платить. План: A/B тестирование цен и форматов, фокус на value proposition, постепенное введение платных функций.',
              'Конкуренция с крупными игроками: Strava или другие могут запустить аналогичные функции. План: фокус на скорость итераций, локальная экспертиза, партнёрства с клубами и организаторами.',
              'Регуляторные риски: изменения в законодательстве по обработке данных. План: соблюдение требований 152-ФЗ, прозрачная политика конфиденциальности, консультации с юристами.',
            ],
            regular,
            semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '9.4. Операционные риски:',
            semiBold,
          ),
          _ul(
            [
              'Недостаток аналитики: без данных сложно принимать решения. План: внедрить Firebase Analytics или Amplitude, трекинг ключевых воронок (онбординг, импорт, маркетплейс), дашборды для мониторинга метрик.',
              'Отсутствие push-уведомлений: пользователи забывают о приложении. План: интеграция flutter_local_notifications, сегментация уведомлений, A/B тестирование сообщений.',
              'Поддержка пользователей: рост нагрузки на поддержку при масштабировании. План: FAQ и база знаний, чат-бот для частых вопросов, приоритетная поддержка для PacePro.',
            ],
            regular,
            semiBold,
          ),

          _h2('10. Roadmap на 12 месяцев', semiBold),
          _p(
            '10.1. Фаза 1: Релизная готовность (0–2 месяца)',
            semiBold,
          ),
          _ul(
            [
              'Авторизация: внедрить SMS-авторизацию, убрать временные заглушки токенов, безопасное хранение через FlutterSecureStorage.',
              'Push-уведомления: интеграция flutter_local_notifications, уведомления о новых сообщениях, подписках, событиях и алертах.',
              'Аналитика: настройка Firebase Analytics или Amplitude, трекинг воронок онбординга, импорта, маркетплейса и монетизации.',
              'Онбординг импорта: пошаговые инструкции для подключения Health Connect и Strava, первый импорт тренировки, объяснение преимуществ.',
              'Юридическое: пользовательские соглашения, политика конфиденциальности, обработка персональных данных согласно 152-ФЗ.',
              'Тестирование: краш-тесты, нагрузочное тестирование API, проверка на разных устройствах и версиях ОС.',
            ],
            regular,
            semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '10.2. Фаза 2: Рост и усиление продукта (2–6 месяцев)',
            semiBold,
          ),
          _ul(
            [
              'Рост в якорных городах: запуск performance-маркетинга, партнёрства с клубами и организаторами, работа с инфлюенсерами.',
              'Усиление маркетплейса: улучшение фильтров и поиска, система рейтингов и отзывов, верификация продавцов, платные бусты листингов.',
              'Алерты и уведомления: расширенные настройки алертов на события, push-напоминания о тренировках и задачах, персонализация уведомлений.',
              'Модерация: правила размещения, система репортов, анти-фрод алгоритмы, реакция поддержки на жалобы.',
              'Аналитика продукта: дашборды для мониторинга метрик, A/B тестирование ключевых функций, итерации на основе данных.',
            ],
            regular,
            semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '10.3. Фаза 3: Монетизация и масштабирование (6–12 месяцев)',
            semiBold,
          ),
          _ul(
            [
              'PacePro подписка: разработка премиум-функций (расширенная аналитика, приоритетная поддержка, безлимитные алерты, продвижение профиля), интеграция платежей, A/B тестирование цен.',
              'Партнёрства и affiliate: интеграция с производителями экипировки и организаторами стартов, реферальные программы, крос-промо с клубами.',
              'Реклама и спонсорство: нативная реклама в ленте, спонсорство лидербордов и задач, партнёрские программы с крупными событиями.',
              'Масштабирование: оптимизация производительности, горизонтальное масштабирование API, улучшение офлайн-кэширования, расширение команды при необходимости.',
              'Международная экспансия (опционально): исследование рынков СНГ, локализация приложения, адаптация под местные особенности.',
            ],
            regular,
            semiBold,
          ),

          _h2('11. Use of Funds (Pre‑seed 5–20 млн ₽)', semiBold),
          _p(
            'Ниже представлена примерная структура использования средств в зависимости от размера раунда. '
            'Все цифры являются допущениями и требуют уточнения в зависимости от конкретных условий и приоритетов.',
            regular,
          ),
          pw.SizedBox(height: 8),
          _p(
            '11.1. Сценарий Lean (5–10 млн ₽):',
            semiBold,
          ),
          _table(
            rows: const [
              ['Статья', 'Бюджет', 'Описание'],
              ['Разработка и безопасность', '2–3 млн ₽', 'Auth, push, аналитика, тестирование, безопасность'],
              ['Маркетинг (3 месяца)', '900k–3 млн ₽', 'Performance, инфлюенсеры, партнёрства в якорных городах'],
              ['Операционные расходы', '1–2 млн ₽', 'Серверы, инструменты, юридические, бухгалтерия'],
              ['Резерв', '1–2 млн ₽', 'Непредвиденные расходы и буфер'],
            ],
            regular: regular,
            semiBold: semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '11.2. Сценарий Growth (10–20 млн ₽):',
            semiBold,
          ),
          _table(
            rows: const [
              ['Статья', 'Бюджет', 'Описание'],
              ['Разработка и безопасность', '3–5 млн ₽', 'Расширенная разработка, модерация, масштабирование'],
              ['Маркетинг (3–6 месяцев)', '3–6 млн ₽', 'Усиленный performance, инфлюенсеры, контент, партнёрства'],
              ['Найм (опционально)', '2–4 млн ₽', 'Разработчик, маркетолог или модератор при необходимости'],
              ['Операционные расходы', '1.5–3 млн ₽', 'Серверы, инструменты, юридические, бухгалтерия, офис'],
              ['Резерв', '0.5–2 млн ₽', 'Непредвиденные расходы и буфер'],
            ],
            regular: regular,
            semiBold: semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '11.3. Runway (время до следующего раунда):',
            semiBold,
          ),
          _ul(
            [
              'Lean сценарий (5–10 млн ₽): 9–12 месяцев при расходе 500k–1.1 млн ₽/мес.',
              'Growth сценарий (10–20 млн ₽): 12–15 месяцев при расходе 800k–1.7 млн ₽/мес.',
              'Цель к концу runway: достижение PMF-сигналов (D30 retention ≥10%, положительная unit-экономика по маркетплейсу или PacePro), готовность к Seed раунду.',
            ],
            regular,
            semiBold,
          ),

          _h2('12. Команда и найм', semiBold),
          _p(
            '12.1. Текущая команда:',
            semiBold,
          ),
          _ul(
            [
              'Solo founder: полная ответственность за продукт, разработку, маркетинг и бизнес-развитие.',
              'Преимущества: скорость принятия решений, фокус, низкие операционные расходы.',
              'Риски: ограниченная пропускная способность, риск выгорания, необходимость экспертизы в разных областях.',
            ],
            regular,
            semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '12.2. Потенциальный найм (при Growth сценарии):',
            semiBold,
          ),
          _ul(
            [
              'Разработчик (Flutter/Dart): для ускорения разработки и масштабирования продукта. Зарплата: 150k–250k ₽/мес (допущение).',
              'Маркетолог (performance + контент): для управления рекламными кампаниями и партнёрствами. Зарплата: 100k–200k ₽/мес (допущение).',
              'Модератор/поддержка: для обработки жалоб и вопросов пользователей. Зарплата: 50k–100k ₽/мес (допущение).',
            ],
            regular,
            semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '12.3. Аутсорс и фриланс:',
            semiBold,
          ),
          _ul(
            [
              'Дизайн: UI/UX иконки, иллюстрации, маркетинговые материалы. Бюджет: 50k–200k ₽ за проект (допущение).',
              'Юридические услуги: пользовательские соглашения, политика конфиденциальности, консультации. Бюджет: 100k–300k ₽ (допущение).',
              'Бухгалтерия: ведение учёта и отчётности. Бюджет: 10k–30k ₽/мес (допущение).',
            ],
            regular,
            semiBold,
          ),

          _h2('13. Финансовые прогнозы (допущения)', semiBold),
          _p(
            '13.1. Прогноз выручки на 24 месяца:',
            semiBold,
          ),
          _table(
            rows: const [
              ['Месяц', 'MAU', 'Marketplace', 'PacePro', 'Affiliate', 'Реклама', 'Итого/мес', 'Итого накопительно'],
              ['3', '5k', '10k', '0', '15k', '0', '25k', '75k'],
              ['6', '20k', '50k', '0', '50k', '0', '100k', '375k'],
              ['9', '50k', '150k', '100k', '100k', '0', '350k', '1.2M'],
              ['12', '80k', '250k', '200k', '150k', '50k', '650k', '3.15M'],
              ['18', '150k', '500k', '450k', '300k', '150k', '1.4M', '11.55M'],
              ['24', '300k', '1M', '900k', '600k', '300k', '2.8M', '25.95M'],
            ],
            regular: regular,
            semiBold: semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '13.2. Прогноз расходов на 24 месяца (Growth сценарий):',
            semiBold,
          ),
          _table(
            rows: const [
              ['Месяц', 'Разработка', 'Маркетинг', 'Найм', 'Операционные', 'Итого/мес', 'Итого накопительно'],
              ['1–3', '500k', '800k', '0', '150k', '1.45M', '4.35M'],
              ['4–6', '400k', '600k', '300k', '200k', '1.5M', '8.85M'],
              ['7–9', '300k', '500k', '400k', '250k', '1.45M', '13.2M'],
              ['10–12', '250k', '400k', '400k', '300k', '1.35M', '17.25M'],
              ['13–18', '200k', '300k', '400k', '350k', '1.25M', '24.75M'],
              ['19–24', '150k', '250k', '400k', '400k', '1.2M', '31.95M'],
            ],
            regular: regular,
            semiBold: semiBold,
          ),
          pw.SizedBox(height: 8),
          _p(
            '13.3. Unit-экономика (допущения для месяца 12):',
            semiBold,
          ),
          _ul(
            [
              'CAC (Customer Acquisition Cost): 200–400 ₽ в зависимости от канала.',
              'LTV (Lifetime Value): при среднем сроке жизни пользователя 6 месяцев и конверсии в PacePro 2%: LTV = (2% × 199 ₽ × 6) + (средний GMV в маркетплейсе × take rate) ≈ 24 ₽ + 50–100 ₽ = 74–124 ₽ (допущение, требует валидации).',
              'LTV/CAC ratio: 0.2–0.6 (требует улучшения через оптимизацию retention и монетизации).',
              'Цель: достичь LTV/CAC > 3 для устойчивой unit-экономики.',
            ],
            regular,
            semiBold,
          ),

          _h2('14. Заключение', semiBold),
          _p(
            'PaceUp имеет все предпосылки для успеха на российском рынке спортивных приложений: '
            'автоматический импорт тренировок создаёт мгновенную ценность, маркетплейс решает '
            'реальную проблему вторичного рынка, а nationwide distribution с фокусом на якорные '
            'города обеспечивает масштабируемый рост.',
            regular,
          ),
          pw.SizedBox(height: 8),
          _p(
            'При инвестициях 5–20 млн ₽ мы планируем достичь PMF-сигналов и положительной '
            'unit-экономики в течение 9–15 месяцев, что позволит привлечь Seed раунд для '
            'дальнейшего масштабирования и международной экспансии.',
            regular,
          ),
          pw.SizedBox(height: 8),
          _p(
            'Все цифры, прогнозы и допущения в этом документе требуют валидации на реальных '
            'данных после запуска продукта. Мы готовы к итерациям и быстрой адаптации стратегии '
            'на основе метрик и обратной связи пользователей.',
            regular,
          ),
        ];
      },
      theme: pw.ThemeData.withFont(
        base: regular,
        bold: bold,
        italic: regular,
        boldItalic: bold,
      ),
    ),
  );

  final bytes = await pdf.save();
  outFile.writeAsBytesSync(bytes);
}

// ─────────────────────────────────────────────────────────────────────────────
//                         BUSINESS PLAN HTML (для DOCX)
// ─────────────────────────────────────────────────────────────────────────────

Future<void> _buildBusinessPlanHtml({required File outFile}) async {
  // ─────────────────────────────────────────────────────────────────────────
  // Генерируем HTML версию бизнес-плана, которую Word откроет и сохранит как DOCX.
  // ─────────────────────────────────────────────────────────────────────────
  final today = DateTime.now();
  final dateStr =
      '${today.day.toString().padLeft(2, '0')}.${today.month.toString().padLeft(2, '0')}.${today.year}';

  // Конвертируем логотип в base64 для встраивания в HTML
  final logoBytes = _readBytes(_logoPath);
  final logoBase64 = Uri.dataFromBytes(logoBytes, mimeType: 'image/png')
      .toString()
      .replaceFirst('data:image/png;base64,', '');

  final html = '''
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PaceUp — Бизнес-план для инвестора</title>
  <style>
    @font-face {
      font-family: 'Inter';
      src: url('fonts/Inter-Regular.ttf') format('truetype');
      font-weight: 400;
      font-style: normal;
    }
    @font-face {
      font-family: 'Inter';
      src: url('fonts/Inter-Medium.ttf') format('truetype');
      font-weight: 500;
      font-style: normal;
    }
    @font-face {
      font-family: 'Inter';
      src: url('fonts/Inter-SemiBold.ttf') format('truetype');
      font-weight: 600;
      font-style: normal;
    }
    @font-face {
      font-family: 'Inter';
      src: url('fonts/Inter-Bold.ttf') format('truetype');
      font-weight: 700;
      font-style: normal;
    }
    body {
      font-family: 'Inter', Arial, sans-serif;
      font-size: 11pt;
      line-height: 1.35;
      color: #1C1C1E;
      max-width: 210mm;
      margin: 0 auto;
      padding: 36pt;
      background: #FFFFFF;
    }
    .header {
      display: flex;
      align-items: center;
      margin-bottom: 16pt;
    }
    .logo {
      width: 56px;
      height: 56px;
      margin-right: 14pt;
    }
    .header-text h1 {
      font-size: 24pt;
      font-weight: 700;
      margin: 0 0 4pt 0;
      color: #1C1C1E;
    }
    .header-text .subtitle {
      font-size: 12pt;
      font-weight: 600;
      color: #379AE6;
      margin: 0;
    }
    .meta {
      font-size: 11pt;
      margin-bottom: 10pt;
      color: #6C6C70;
    }
    .disclaimer {
      background: #F2F2F7;
      border: 1px solid #E5E5EA;
      border-radius: 8px;
      padding: 10pt;
      margin: 18pt 0;
      font-size: 10pt;
      color: #1C1C1E;
    }
    h2 {
      font-size: 16pt;
      font-weight: 600;
      color: #1C1C1E;
      margin-top: 12pt;
      margin-bottom: 6pt;
    }
    h3 {
      font-size: 12pt;
      font-weight: 600;
      color: #1C1C1E;
      margin-top: 8pt;
      margin-bottom: 4pt;
    }
    p {
      margin: 0 0 6pt 0;
      text-align: justify;
    }
    ul {
      margin: 0 0 8pt 0;
      padding-left: 20pt;
    }
    li {
      margin-bottom: 4pt;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 8pt 0;
      font-size: 10pt;
    }
    table th {
      background: #379AE6;
      color: #FFFFFF;
      font-weight: 600;
      padding: 6pt;
      text-align: left;
      border: 0.6pt solid #CCCCCC;
    }
    table td {
      padding: 6pt;
      border: 0.6pt solid #CCCCCC;
    }
    table tr:nth-child(even) {
      background: #FAFAFC;
    }
    .spacer {
      height: 8pt;
    }
    .page-break {
      page-break-before: always;
    }
  </style>
</head>
<body>
  <div class="header">
    <img src="data:image/png;base64,$logoBase64" alt="PaceUp Logo" class="logo">
    <div class="header-text">
      <h1>PaceUp</h1>
      <p class="subtitle">Бизнес‑план для инвестора (черновик)</p>
    </div>
  </div>
  
  <div class="meta">
    Дата: $dateStr · География: Россия · Стадия: MVP (pre‑launch) · Раунд: Pre‑seed 5–20 млн ₽
  </div>
  
  <ul>
    <li>Мультиспорт: бег / вело / плавание</li>
    <li>Nationwide доступность + рост через 10–20 якорных городов</li>
    <li>Авто‑контент: импорт тренировок (Health Connect + Strava)</li>
    <li>Маркет: слоты на старты и экипировка + чаты сделок</li>
  </ul>
  
  <div class="disclaimer">
    <strong>Дисклеймер:</strong> все цифры, рынки, KPI и финмодель в этом документе 
    являются допущениями (черновик) и требуют валидации на фактах.
  </div>

  <h2>1. Executive Summary</h2>
  <p>
    PaceUp — это спортивная платформа нового поколения, объединяющая тренировки, 
    социальную мотивацию, локальные события и сделки в едином продукте. Мы решаем 
    проблему фрагментации спортивного сообщества, предоставляя пользователям 
    автоматический импорт тренировок, карту событий и клубов, а также маркетплейс 
    для слотов на старты и экипировки.
  </p>
  <div class="spacer"></div>
  <p>
    Наш подход — nationwide distribution с первого дня запуска, с фокусом на рост 
    и партнёрства в 10–20 якорных городах России. Монетизация строится на 
    комиссиях с транзакций маркетплейса, affiliate-программах, подписке PacePro 
    и рекламе после достижения масштаба.
  </p>
  <div class="spacer"></div>
  <p>
    Мы ищем Pre‑seed инвестиции в размере 5–20 млн ₽ для достижения PMF-сигналов 
    и подтверждения unit-экономики в течение 9–15 месяцев.
  </p>

  <h2>2. Проблема и решение</h2>
  <h3>2.1. Проблемы рынка:</h3>
  <ul>
    <li>Мотивация и удержание спортсменов-любителей ломается без сообщества и обратной связи. Большинство бросает тренировки в первые 3 месяца из-за отсутствия поддержки и видимого прогресса.</li>
    <li>События, клубы и коммуникации разбросаны по разным каналам: соцсети, мессенджеры, сайты организаторов. Нет единой точки входа для поиска локальных активностей.</li>
    <li>Вторичный рынок слотов на старты и экипировки хаотичен и небезопасен. Пользователи вынуждены искать предложения в группах соцсетей без гарантий и удобных инструментов сделок.</li>
    <li>Тренировочные данные хранятся в разных приложениях (Strava, Garmin, Apple Health), что усложняет анализ прогресса и соревновательный элемент.</li>
  </ul>
  <div class="spacer"></div>
  <h3>2.2. Решение PaceUp:</h3>
  <ul>
    <li>Автоматический импорт тренировок из Health Connect (Android) и Strava создаёт мгновенный "aha moment" — пользователь видит свой контент без ручного ввода.</li>
    <li>Лента тренировок и постов с подписками формирует социальный граф и мотивацию через сравнение и поддержку сообщества.</li>
    <li>Карта событий и клубов с кластеризацией маркеров даёт единую точку поиска локальных активностей.</li>
    <li>Маркетплейс слотов и экипировки с встроенными чатами и статусами сделок решает проблему доверия и удобства транзакций.</li>
    <li>Offline-first архитектура обеспечивает мгновенную загрузку и работу без интернета, что критично для спортивных приложений.</li>
  </ul>

  <h2>3. Продукт (MVP)</h2>
  <h3>3.1. Лента активности:</h3>
  <ul>
    <li>Бесконечная лента тренировок и постов с курсорной пагинацией и дедупликацией по ID.</li>
    <li>Pull-to-refresh для обновления контента без потери позиции скролла.</li>
    <li>Лайки, комментарии и подписки для формирования социального графа.</li>
    <li>Кэширование в Drift (SQLite) для мгновенной загрузки и офлайн-режима.</li>
  </ul>
  <div class="spacer"></div>
  <h3>3.2. Импорт тренировок:</h3>
  <ul>
    <li>Health Connect (Android): автоматическая синхронизация новых тренировок с извлечением дистанции, пульса, каденса, калорий и GPS-маршрута через MethodChannel.</li>
    <li>Strava: серверная синхронизация через API endpoint с поддержкой всех типов активностей.</li>
    <li>Онбординг с пошаговыми инструкциями для подключения трекеров и первого импорта.</li>
  </ul>
  <div class="spacer"></div>
  <h3>3.3. Карта событий и клубов:</h3>
  <ul>
    <li>Интеграция Mapbox и MapTiler для отображения карт с кластеризацией маркеров через GeoJSON источники.</li>
    <li>Фильтрация по типам событий (бег, вело, плавание) и датам.</li>
    <li>Статические OSM-карты для маршрутов тренировок с полилиниями в brandPrimary цвете.</li>
  </ul>
  <div class="spacer"></div>
  <h3>3.4. Маркетплейс:</h3>
  <ul>
    <li>Два типа товаров: "Слоты" (места на старты) и "Вещи" (экипировка).</li>
    <li>Фильтрация по категориям, цене, расстоянию и статусу.</li>
    <li>Встроенные чаты для обсуждения сделок с уведомлениями о новых сообщениях.</li>
    <li>Статусы сделок: резерв, оплата, завершено, отменено.</li>
    <li>Алерты на новые слоты по выбранным событиям и расстоянию.</li>
  </ul>
  <div class="spacer"></div>
  <h3>3.5. Дополнительные функции:</h3>
  <ul>
    <li>Профиль пользователя с табами: главная, фото, статистика, тренировки, старты, экипировка, клубы, награды, навыки.</li>
    <li>Задачи (Tasks) с активными и доступными категориями для геймификации.</li>
    <li>Лидерборды по подпискам, всем пользователям и городам с фильтрацией по спорту, периоду, полу и параметру.</li>
    <li>Уведомления и бейджи непрочитанных сообщений и алертов.</li>
  </ul>
  <div class="spacer"></div>
  <h3>3.6. Техническая база:</h3>
  <ul>
    <li>Offline-first кэширование через Drift (SQLite) для ленты, профилей и маршрутов.</li>
    <li>Unified image cache с пропорциональным ресайзингом для оптимизации памяти и трафика.</li>
    <li>API Service с connection pooling, retry logic (exponential backoff) и автоматическим добавлением токенов.</li>
    <li>Riverpod для state management с генерацией провайдеров через аннотации.</li>
  </ul>

  <h2>4. Рынок (TAM/SAM/SOM)</h2>
  <p>
    Ниже представлены три сценария оценки рынка. Все цифры являются допущениями 
    и требуют валидации через маркетинговые исследования и аналитику после запуска.
  </p>
  <div class="spacer"></div>
  <table>
    <thead>
      <tr>
        <th>Метрика</th>
        <th>Консервативно</th>
        <th>Базово</th>
        <th>Агрессивно</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>TAM: спорт-активные пользователи смартфонов в РФ</td>
        <td>12 млн</td>
        <td>20 млн</td>
        <td>30 млн</td>
      </tr>
      <tr>
        <td>SAM: мультиспорт аудитория (бег/вело/плавание)</td>
        <td>3 млн</td>
        <td>6 млн</td>
        <td>10 млн</td>
      </tr>
      <tr>
        <td>SOM (12 мес): достижимые MAU</td>
        <td>30k</td>
        <td>80k</td>
        <td>200k</td>
      </tr>
      <tr>
        <td>SOM (24 мес): достижимые MAU</td>
        <td>100k</td>
        <td>300k</td>
        <td>800k</td>
      </tr>
    </tbody>
  </table>
  <div class="spacer"></div>
  <h3>4.1. Сегментация аудитории:</h3>
  <ul>
    <li><strong>B2C Amateur:</strong> любители, которые тренируются 1–3 раза в неделю для здоровья и удовольствия. Цель — мотивация и сообщество.</li>
    <li><strong>B2C Serious:</strong> серьёзные спортсмены, тренирующиеся 4+ раз в неделю с целями участия в соревнованиях. Цель — анализ прогресса и поиск стартов.</li>
    <li><strong>Клубы:</strong> спортивные клубы и сообщества, нуждающиеся в инструментах для организации тренировок и привлечения участников.</li>
    <li><strong>Организаторы событий:</strong> компании, проводящие старты и нуждающиеся в продвижении и продаже слотов.</li>
    <li><strong>Тренеры:</strong> индивидуальные тренеры, ищущие клиентов и инструменты для отслеживания прогресса подопечных.</li>
    <li><strong>Бренды:</strong> производители экипировки и спонсоры, заинтересованные в таргетированной рекламе и affiliate-программах.</li>
  </ul>

  <h2>5. Монетизация (по фазам)</h2>
  <h3>5.1. Фаза A (0–6 месяцев): Marketplace и Affiliate</h3>
  <ul>
    <li>Take rate 3–7% с транзакций маркетплейса (слоты и экипировка). При среднем чеке 2000–5000 ₽ и 100–500 транзакций в месяц это даёт 6k–175k ₽/мес (допущение).</li>
    <li>Платные бусты листингов в маркетплейсе: 99–299 ₽ за поднятие объявления в топ на 7 дней. Целевая конверсия: 5–10% продавцов используют бусты.</li>
    <li>Affiliate-программы с производителями экипировки и организаторами стартов: 5–15% с продаж. При GMV 500k–2 млн ₽/мес это 25k–300k ₽/мес (допущение).</li>
  </ul>
  <div class="spacer"></div>
  <h3>5.2. Фаза B (6–12 месяцев): PacePro подписка</h3>
  <ul>
    <li>Премиум-подписка PacePro: 199 ₽/мес или 1490 ₽/год (экономия 2 месяца).</li>
    <li>Премиум-функции: расширенная аналитика, приоритетная поддержка, безлимитные алерты, продвижение профиля, эксклюзивные задачи и награды.</li>
    <li>Целевая конверсия: 1–3% от MAU при достижении 50k+ активных пользователей. При 50k MAU и 2% конверсии это 1000 подписок × 199 ₽ = 199k ₽/мес (допущение).</li>
  </ul>
  <div class="spacer"></div>
  <h3>5.3. Фаза C (12+ месяцев): Реклама и спонсорство</h3>
  <ul>
    <li>Нативная реклама в ленте от брендов экипировки и организаторов событий: 50k–200k ₽ за размещение на месяц (допущение).</li>
    <li>Спонсорство лидербордов и задач: 100k–500k ₽ за кампанию (допущение).</li>
    <li>Партнёрские программы с крупными событиями и клубами: revenue share 10–20% (допущение).</li>
  </ul>
  <div class="spacer"></div>
  <h3>5.4. Прогноз выручки (допущения):</h3>
  <table>
    <thead>
      <tr>
        <th>Месяц</th>
        <th>MAU</th>
        <th>Marketplace</th>
        <th>PacePro</th>
        <th>Affiliate</th>
        <th>Реклама</th>
        <th>Итого/мес</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>3</td><td>5k</td><td>10k</td><td>0</td><td>15k</td><td>0</td><td>25k</td></tr>
      <tr><td>6</td><td>20k</td><td>50k</td><td>0</td><td>50k</td><td>0</td><td>100k</td></tr>
      <tr><td>9</td><td>50k</td><td>150k</td><td>100k</td><td>100k</td><td>0</td><td>350k</td></tr>
      <tr><td>12</td><td>80k</td><td>250k</td><td>200k</td><td>150k</td><td>50k</td><td>650k</td></tr>
      <tr><td>18</td><td>150k</td><td>500k</td><td>450k</td><td>300k</td><td>150k</td><td>1.4M</td></tr>
      <tr><td>24</td><td>300k</td><td>1M</td><td>900k</td><td>600k</td><td>300k</td><td>2.8M</td></tr>
    </tbody>
  </table>

  <h2>6. Go‑To‑Market: Nationwide + фокус городов</h2>
  <h3>6.1. Стратегия запуска:</h3>
  <ul>
    <li>Nationwide distribution с первого дня: приложение доступно для скачивания по всей России через App Store и Google Play.</li>
    <li>Фокус на рост и партнёрства в 10–20 якорных городах: Москва, СПб, Казань, Екатеринбург, Новосибирск, Нижний Новгород, Краснодар, Ростов-на-Дону, Самара, Уфа, Челябинск, Воронеж, Пермь, Волгоград, Омск, Красноярск, Воронеж, Иркутск, Тюмень, Сочи.</li>
    <li>Критерии выбора якорных городов: плотность стартов и клубов, активность в Strava и соцсетях, наличие инфлюенсеров и медиа-партнёров.</li>
  </ul>
  <div class="spacer"></div>
  <h3>6.2. Маркетинговый бюджет и каналы (первые 3 месяца):</h3>
  <ul>
    <li>Бюджет: 300k–1 млн ₽/мес в зависимости от раунда (Lean vs Growth).</li>
    <li>Performance-маркетинг (40–50% бюджета): таргетированная реклама в VK, Яндекс.Директ, myTarget с фокусом на аудиторию 25–45 лет, интересующуюся спортом.</li>
    <li>Инфлюенсеры (20–30% бюджета): партнёрства с бегунами, велосипедистами и триатлетами с аудиторией 10k–100k подписчиков. Формат: обзоры, челленджи, промокоды.</li>
    <li>Партнёрства (15–20% бюджета): сотрудничество с клубами, организаторами стартов и магазинами экипировки для кросс-промо и реферальных программ.</li>
    <li>Контент-маркетинг (10–15% бюджета): статьи, видео и посты о тренировках, событиях и экипировке для привлечения органического трафика.</li>
  </ul>
  <div class="spacer"></div>
  <h3>6.3. KPI по каналам (цели, допущения):</h3>
  <table>
    <thead>
      <tr>
        <th>Канал</th>
        <th>CAC (допущение)</th>
        <th>Конверсия в установку</th>
        <th>D7 Retention</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>Performance</td><td>200–500 ₽</td><td>2–5%</td><td>25–35%</td></tr>
      <tr><td>Инфлюенсеры</td><td>150–400 ₽</td><td>3–7%</td><td>30–40%</td></tr>
      <tr><td>Партнёрства</td><td>100–300 ₽</td><td>5–10%</td><td>35–45%</td></tr>
      <tr><td>Органика</td><td>50–150 ₽</td><td>1–3%</td><td>20–30%</td></tr>
    </tbody>
  </table>

  <h2>7. KPI и метрики продукта</h2>
  <h3>7.1. Activation (первые 48 часов):</h3>
  <ul>
    <li>≥30% пользователей подключили трекер (Health Connect или Strava) в течение первого сеанса.</li>
    <li>≥20% пользователей импортировали хотя бы одну тренировку за первые 48 часов после установки.</li>
    <li>≥15% пользователей создали первый пост или оставили комментарий в течение недели.</li>
  </ul>
  <div class="spacer"></div>
  <h3>7.2. Retention (удержание):</h3>
  <ul>
    <li>D1 (день 1): 50–60% пользователей возвращаются на следующий день.</li>
    <li>D7 (день 7): 20–30% пользователей активны через неделю после установки.</li>
    <li>D30 (день 30): 10–15% пользователей остаются активными через месяц.</li>
    <li>D90 (день 90): 5–8% пользователей формируют ядро долгосрочной аудитории.</li>
  </ul>
  <div class="spacer"></div>
  <h3>7.3. Marketplace метрики:</h3>
  <ul>
    <li>≥3–7% активных пользователей инициируют чат сделки в месяц (просмотр → чат).</li>
    <li>Конверсия чат → резерв: 30–50% (допущение).</li>
    <li>Конверсия резерв → оплата: 60–80% (допущение).</li>
    <li>Средний чек транзакции: 2000–5000 ₽ (допущение).</li>
    <li>Take rate: 3–7% с каждой успешной сделки.</li>
  </ul>
  <div class="spacer"></div>
  <h3>7.4. PacePro конверсия:</h3>
  <ul>
    <li>При MAU 50k+: целевая конверсия в подписку 1–3% (500–1500 подписок).</li>
    <li>При MAU 100k+: целевая конверсия 2–4% (2000–4000 подписок).</li>
    <li>Churn rate (отток): ≤5% в месяц для здоровой unit-экономики.</li>
  </ul>

  <h2>8. Конкурентный анализ</h2>
  <h3>8.1. Прямые конкуренты:</h3>
  <ul>
    <li><strong>Strava:</strong> мировой лидер в трекинге тренировок с сильным социальным компонентом. Сильные стороны: большая база пользователей, интеграции с устройствами. Слабые: нет маркетплейса, слабая локализация для России, нет фокуса на локальных событиях.</li>
    <li><strong>Garmin Connect:</strong> экосистема для владельцев устройств Garmin. Сильные: точные данные, аналитика. Слабые: привязанность к устройствам, слабый социальный компонент, нет маркетплейса.</li>
    <li><strong>Nike Run Club / Adidas Running:</strong> брендовые приложения с мотивацией. Сильные: бренд, геймификация. Слабые: фокус только на беге, нет маркетплейса, слабая локализация.</li>
  </ul>
  <div class="spacer"></div>
  <h3>8.2. Косвенные конкуренты:</h3>
  <ul>
    <li><strong>Группы в соцсетях (VK, Telegram):</strong> для поиска событий и покупки слотов. Сильные: бесплатность, простота. Слабые: нет структуры, риски мошенничества, нет автоматизации.</li>
    <li><strong>Сайты организаторов стартов:</strong> для регистрации на события. Сильные: официальность. Слабые: фрагментация, нет единой точки входа, нет вторичного рынка.</li>
    <li><strong>Avito / Юла:</strong> для покупки экипировки. Сильные: большой выбор. Слабые: нет спортивного контекста, нет доверия, нет интеграции с тренировками.</li>
  </ul>
  <div class="spacer"></div>
  <h3>8.3. Наши дифференциаторы:</h3>
  <ul>
    <li>Автоматический импорт тренировок создаёт мгновенный "aha moment" без ручного ввода данных.</li>
    <li>Маркетплейс слотов и экипировки с встроенными чатами решает проблему вторичного рынка в спорте.</li>
    <li>Фокус на локальных событиях и клубах через карту с кластеризацией.</li>
    <li>Offline-first архитектура обеспечивает мгновенную загрузку и работу без интернета.</li>
    <li>Мультиспорт подход (бег, вело, плавание) в одном приложении.</li>
    <li>Nationwide доступность с первого дня с фокусом на российский рынок.</li>
  </ul>

  <h2>9. Риски и план их закрытия</h2>
  <h3>9.1. Технические риски:</h3>
  <ul>
    <li><strong>Auth/токены:</strong> в MVP используются временные заглушки. План: внедрить полноценную SMS-авторизацию с безопасным хранением access/refresh токенов через FlutterSecureStorage до релиза.</li>
    <li><strong>Масштабирование API:</strong> текущий бэкенд может не выдержать нагрузку при росте. План: мониторинг метрик, горизонтальное масштабирование, кэширование на уровне API.</li>
    <li><strong>Синхронизация данных:</strong> конфликты при офлайн-редактировании. План: реализовать optimistic updates и conflict resolution через версионирование.</li>
  </ul>
  <div class="spacer"></div>
  <h3>9.2. Продуктовые риски:</h3>
  <ul>
    <li><strong>Модерация маркетплейса:</strong> риск мошенничества и некачественных товаров. План: правила размещения, система репортов, верификация продавцов, рейтинги и отзывы, анти-фрод алгоритмы.</li>
    <li><strong>Качество контента в ленте:</strong> спам и низкокачественные посты. План: алгоритмическая лента с релевантностью, модерация контента, возможность скрытия постов.</li>
    <li><strong>Удержание пользователей:</strong> риск низкого retention без достаточной активности сообщества. План: онбординг импорта, push-уведомления о подписках и событиях, геймификация через задачи и лидерборды.</li>
  </ul>
  <div class="spacer"></div>
  <h3>9.3. Бизнес-риски:</h3>
  <ul>
    <li><strong>Низкая конверсия в монетизацию:</strong> пользователи не готовы платить. План: A/B тестирование цен и форматов, фокус на value proposition, постепенное введение платных функций.</li>
    <li><strong>Конкуренция с крупными игроками:</strong> Strava или другие могут запустить аналогичные функции. План: фокус на скорость итераций, локальная экспертиза, партнёрства с клубами и организаторами.</li>
    <li><strong>Регуляторные риски:</strong> изменения в законодательстве по обработке данных. План: соблюдение требований 152-ФЗ, прозрачная политика конфиденциальности, консультации с юристами.</li>
  </ul>
  <div class="spacer"></div>
  <h3>9.4. Операционные риски:</h3>
  <ul>
    <li><strong>Недостаток аналитики:</strong> без данных сложно принимать решения. План: внедрить Firebase Analytics или Amplitude, трекинг ключевых воронок (онбординг, импорт, маркетплейс), дашборды для мониторинга метрик.</li>
    <li><strong>Отсутствие push-уведомлений:</strong> пользователи забывают о приложении. План: интеграция flutter_local_notifications, сегментация уведомлений, A/B тестирование сообщений.</li>
    <li><strong>Поддержка пользователей:</strong> рост нагрузки на поддержку при масштабировании. План: FAQ и база знаний, чат-бот для частых вопросов, приоритетная поддержка для PacePro.</li>
  </ul>

  <h2>10. Roadmap на 12 месяцев</h2>
  <h3>10.1. Фаза 1: Релизная готовность (0–2 месяца)</h3>
  <ul>
    <li>Авторизация: внедрить SMS-авторизацию, убрать временные заглушки токенов, безопасное хранение через FlutterSecureStorage.</li>
    <li>Push-уведомления: интеграция flutter_local_notifications, уведомления о новых сообщениях, подписках, событиях и алертах.</li>
    <li>Аналитика: настройка Firebase Analytics или Amplitude, трекинг воронок онбординга, импорта, маркетплейса и монетизации.</li>
    <li>Онбординг импорта: пошаговые инструкции для подключения Health Connect и Strava, первый импорт тренировки, объяснение преимуществ.</li>
    <li>Юридическое: пользовательские соглашения, политика конфиденциальности, обработка персональных данных согласно 152-ФЗ.</li>
    <li>Тестирование: краш-тесты, нагрузочное тестирование API, проверка на разных устройствах и версиях ОС.</li>
  </ul>
  <div class="spacer"></div>
  <h3>10.2. Фаза 2: Рост и усиление продукта (2–6 месяцев)</h3>
  <ul>
    <li>Рост в якорных городах: запуск performance-маркетинга, партнёрства с клубами и организаторами, работа с инфлюенсерами.</li>
    <li>Усиление маркетплейса: улучшение фильтров и поиска, система рейтингов и отзывов, верификация продавцов, платные бусты листингов.</li>
    <li>Алерты и уведомления: расширенные настройки алертов на события, push-напоминания о тренировках и задачах, персонализация уведомлений.</li>
    <li>Модерация: правила размещения, система репортов, анти-фрод алгоритмы, реакция поддержки на жалобы.</li>
    <li>Аналитика продукта: дашборды для мониторинга метрик, A/B тестирование ключевых функций, итерации на основе данных.</li>
  </ul>
  <div class="spacer"></div>
  <h3>10.3. Фаза 3: Монетизация и масштабирование (6–12 месяцев)</h3>
  <ul>
    <li>PacePro подписка: разработка премиум-функций (расширенная аналитика, приоритетная поддержка, безлимитные алерты, продвижение профиля), интеграция платежей, A/B тестирование цен.</li>
    <li>Партнёрства и affiliate: интеграция с производителями экипировки и организаторами стартов, реферальные программы, крос-промо с клубами.</li>
    <li>Реклама и спонсорство: нативная реклама в ленте, спонсорство лидербордов и задач, партнёрские программы с крупными событиями.</li>
    <li>Масштабирование: оптимизация производительности, горизонтальное масштабирование API, улучшение офлайн-кэширования, расширение команды при необходимости.</li>
    <li>Международная экспансия (опционально): исследование рынков СНГ, локализация приложения, адаптация под местные особенности.</li>
  </ul>

  <h2>11. Use of Funds (Pre‑seed 5–20 млн ₽)</h2>
  <p>
    Ниже представлена примерная структура использования средств в зависимости от размера раунда. 
    Все цифры являются допущениями и требуют уточнения в зависимости от конкретных условий и приоритетов.
  </p>
  <div class="spacer"></div>
  <h3>11.1. Сценарий Lean (5–10 млн ₽):</h3>
  <table>
    <thead>
      <tr>
        <th>Статья</th>
        <th>Бюджет</th>
        <th>Описание</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Разработка и безопасность</td>
        <td>2–3 млн ₽</td>
        <td>Auth, push, аналитика, тестирование, безопасность</td>
      </tr>
      <tr>
        <td>Маркетинг (3 месяца)</td>
        <td>900k–3 млн ₽</td>
        <td>Performance, инфлюенсеры, партнёрства в якорных городах</td>
      </tr>
      <tr>
        <td>Операционные расходы</td>
        <td>1–2 млн ₽</td>
        <td>Серверы, инструменты, юридические, бухгалтерия</td>
      </tr>
      <tr>
        <td>Резерв</td>
        <td>1–2 млн ₽</td>
        <td>Непредвиденные расходы и буфер</td>
      </tr>
    </tbody>
  </table>
  <div class="spacer"></div>
  <h3>11.2. Сценарий Growth (10–20 млн ₽):</h3>
  <table>
    <thead>
      <tr>
        <th>Статья</th>
        <th>Бюджет</th>
        <th>Описание</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Разработка и безопасность</td>
        <td>3–5 млн ₽</td>
        <td>Расширенная разработка, модерация, масштабирование</td>
      </tr>
      <tr>
        <td>Маркетинг (3–6 месяцев)</td>
        <td>3–6 млн ₽</td>
        <td>Усиленный performance, инфлюенсеры, контент, партнёрства</td>
      </tr>
      <tr>
        <td>Найм (опционально)</td>
        <td>2–4 млн ₽</td>
        <td>Разработчик, маркетолог или модератор при необходимости</td>
      </tr>
      <tr>
        <td>Операционные расходы</td>
        <td>1.5–3 млн ₽</td>
        <td>Серверы, инструменты, юридические, бухгалтерия, офис</td>
      </tr>
      <tr>
        <td>Резерв</td>
        <td>0.5–2 млн ₽</td>
        <td>Непредвиденные расходы и буфер</td>
      </tr>
    </tbody>
  </table>
  <div class="spacer"></div>
  <h3>11.3. Runway (время до следующего раунда):</h3>
  <ul>
    <li>Lean сценарий (5–10 млн ₽): 9–12 месяцев при расходе 500k–1.1 млн ₽/мес.</li>
    <li>Growth сценарий (10–20 млн ₽): 12–15 месяцев при расходе 800k–1.7 млн ₽/мес.</li>
    <li>Цель к концу runway: достижение PMF-сигналов (D30 retention ≥10%, положительная unit-экономика по маркетплейсу или PacePro), готовность к Seed раунду.</li>
  </ul>

  <h2>12. Команда и найм</h2>
  <h3>12.1. Текущая команда:</h3>
  <ul>
    <li><strong>Solo founder:</strong> полная ответственность за продукт, разработку, маркетинг и бизнес-развитие.</li>
    <li><strong>Преимущества:</strong> скорость принятия решений, фокус, низкие операционные расходы.</li>
    <li><strong>Риски:</strong> ограниченная пропускная способность, риск выгорания, необходимость экспертизы в разных областях.</li>
  </ul>
  <div class="spacer"></div>
  <h3>12.2. Потенциальный найм (при Growth сценарии):</h3>
  <ul>
    <li><strong>Разработчик (Flutter/Dart):</strong> для ускорения разработки и масштабирования продукта. Зарплата: 150k–250k ₽/мес (допущение).</li>
    <li><strong>Маркетолог (performance + контент):</strong> для управления рекламными кампаниями и партнёрствами. Зарплата: 100k–200k ₽/мес (допущение).</li>
    <li><strong>Модератор/поддержка:</strong> для обработки жалоб и вопросов пользователей. Зарплата: 50k–100k ₽/мес (допущение).</li>
  </ul>
  <div class="spacer"></div>
  <h3>12.3. Аутсорс и фриланс:</h3>
  <ul>
    <li><strong>Дизайн:</strong> UI/UX иконки, иллюстрации, маркетинговые материалы. Бюджет: 50k–200k ₽ за проект (допущение).</li>
    <li><strong>Юридические услуги:</strong> пользовательские соглашения, политика конфиденциальности, консультации. Бюджет: 100k–300k ₽ (допущение).</li>
    <li><strong>Бухгалтерия:</strong> ведение учёта и отчётности. Бюджет: 10k–30k ₽/мес (допущение).</li>
  </ul>

  <h2>13. Финансовые прогнозы (допущения)</h2>
  <h3>13.1. Прогноз выручки на 24 месяца:</h3>
  <table>
    <thead>
      <tr>
        <th>Месяц</th>
        <th>MAU</th>
        <th>Marketplace</th>
        <th>PacePro</th>
        <th>Affiliate</th>
        <th>Реклама</th>
        <th>Итого/мес</th>
        <th>Итого накопительно</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>3</td><td>5k</td><td>10k</td><td>0</td><td>15k</td><td>0</td><td>25k</td><td>75k</td></tr>
      <tr><td>6</td><td>20k</td><td>50k</td><td>0</td><td>50k</td><td>0</td><td>100k</td><td>375k</td></tr>
      <tr><td>9</td><td>50k</td><td>150k</td><td>100k</td><td>100k</td><td>0</td><td>350k</td><td>1.2M</td></tr>
      <tr><td>12</td><td>80k</td><td>250k</td><td>200k</td><td>150k</td><td>50k</td><td>650k</td><td>3.15M</td></tr>
      <tr><td>18</td><td>150k</td><td>500k</td><td>450k</td><td>300k</td><td>150k</td><td>1.4M</td><td>11.55M</td></tr>
      <tr><td>24</td><td>300k</td><td>1M</td><td>900k</td><td>600k</td><td>300k</td><td>2.8M</td><td>25.95M</td></tr>
    </tbody>
  </table>
  <div class="spacer"></div>
  <h3>13.2. Прогноз расходов на 24 месяца (Growth сценарий):</h3>
  <table>
    <thead>
      <tr>
        <th>Месяц</th>
        <th>Разработка</th>
        <th>Маркетинг</th>
        <th>Найм</th>
        <th>Операционные</th>
        <th>Итого/мес</th>
        <th>Итого накопительно</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>1–3</td><td>500k</td><td>800k</td><td>0</td><td>150k</td><td>1.45M</td><td>4.35M</td></tr>
      <tr><td>4–6</td><td>400k</td><td>600k</td><td>300k</td><td>200k</td><td>1.5M</td><td>8.85M</td></tr>
      <tr><td>7–9</td><td>300k</td><td>500k</td><td>400k</td><td>250k</td><td>1.45M</td><td>13.2M</td></tr>
      <tr><td>10–12</td><td>250k</td><td>400k</td><td>400k</td><td>300k</td><td>1.35M</td><td>17.25M</td></tr>
      <tr><td>13–18</td><td>200k</td><td>300k</td><td>400k</td><td>350k</td><td>1.25M</td><td>24.75M</td></tr>
      <tr><td>19–24</td><td>150k</td><td>250k</td><td>400k</td><td>400k</td><td>1.2M</td><td>31.95M</td></tr>
    </tbody>
  </table>
  <div class="spacer"></div>
  <h3>13.3. Unit-экономика (допущения для месяца 12):</h3>
  <ul>
    <li><strong>CAC (Customer Acquisition Cost):</strong> 200–400 ₽ в зависимости от канала.</li>
    <li><strong>LTV (Lifetime Value):</strong> при среднем сроке жизни пользователя 6 месяцев и конверсии в PacePro 2%: LTV = (2% × 199 ₽ × 6) + (средний GMV в маркетплейсе × take rate) ≈ 24 ₽ + 50–100 ₽ = 74–124 ₽ (допущение, требует валидации).</li>
    <li><strong>LTV/CAC ratio:</strong> 0.2–0.6 (требует улучшения через оптимизацию retention и монетизации).</li>
    <li><strong>Цель:</strong> достичь LTV/CAC > 3 для устойчивой unit-экономики.</li>
  </ul>

  <h2>14. Заключение</h2>
  <p>
    PaceUp имеет все предпосылки для успеха на российском рынке спортивных приложений: 
    автоматический импорт тренировок создаёт мгновенную ценность, маркетплейс решает 
    реальную проблему вторичного рынка, а nationwide distribution с фокусом на якорные 
    города обеспечивает масштабируемый рост.
  </p>
  <div class="spacer"></div>
  <p>
    При инвестициях 5–20 млн ₽ мы планируем достичь PMF-сигналов и положительной 
    unit-экономики в течение 9–15 месяцев, что позволит привлечь Seed раунд для 
    дальнейшего масштабирования и международной экспансии.
  </p>
  <div class="spacer"></div>
  <p>
    Все цифры, прогнозы и допущения в этом документе требуют валидации на реальных 
    данных после запуска продукта. Мы готовы к итерациям и быстрой адаптации стратегии 
    на основе метрик и обратной связи пользователей.
  </p>
</body>
</html>
''';

  outFile.writeAsStringSync(html, encoding: utf8);
}

// ─────────────────────────────────────────────────────────────────────────────
//                                     MAIN
// ─────────────────────────────────────────────────────────────────────────────

Future<void> main() async {
  // ─────────────────────────────────────────────────────────────────────────
  // 1) Проверяем ресурсы.
  // 2) Поднимаем шрифты/логотип в память.
  // 3) Генерируем 2 PDF файла в investor/.
  // ─────────────────────────────────────────────────────────────────────────

  _investorDir.createSync(recursive: true);

  _mustExist(_logoPath);
  _mustExist(_fontRegularPath);
  _mustExist(_fontMediumPath);
  _mustExist(_fontSemiBoldPath);
  _mustExist(_fontBoldPath);

  final logo = pw.MemoryImage(_readBytes(_logoPath));

  final fontRegular = pw.Font.ttf(_readBytes(_fontRegularPath).buffer.asByteData());
  final fontMedium = pw.Font.ttf(_readBytes(_fontMediumPath).buffer.asByteData());
  final fontSemiBold = pw.Font.ttf(_readBytes(_fontSemiBoldPath).buffer.asByteData());
  final fontBold = pw.Font.ttf(_readBytes(_fontBoldPath).buffer.asByteData());

  final deckOut = File('${_investorDir.path}/paceup_deck.pdf');
  final planOut = File('${_investorDir.path}/paceup_business_plan.pdf');

  await _buildDeckPdf(
    logo: logo,
    regular: fontRegular,
    semiBold: fontSemiBold,
    bold: fontBold,
    outFile: deckOut,
  );

  await _buildBusinessPlanPdf(
    logo: logo,
    regular: fontRegular,
    medium: fontMedium,
    semiBold: fontSemiBold,
    bold: fontBold,
    outFile: planOut,
  );

  // ─────────────────────────────────────────────────────────────────────────
  // 4) Генерируем HTML версию бизнес-плана для конвертации в DOCX.
  // ─────────────────────────────────────────────────────────────────────────
  final planHtmlOut = File('${_investorDir.path}/paceup_business_plan.html');
  await _buildBusinessPlanHtml(outFile: planHtmlOut);

  // ─────────────────────────────────────────────────────────────────────────
  // Итог: печатаем пути, чтобы в CI/IDE их было видно.
  // ─────────────────────────────────────────────────────────────────────────
  stdout.writeln('OK');
  stdout.writeln('Deck: ${deckOut.path}');
  stdout.writeln('Plan PDF: ${planOut.path}');
  stdout.writeln('Plan HTML: ${planHtmlOut.path}');
  stdout.writeln('');
  stdout.writeln('Для получения DOCX: откройте HTML в Microsoft Word и сохраните как .docx');
}


